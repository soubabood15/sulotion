<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <link rel="icon" href="jordan.png" type="image/png" sizes="32x32">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>اعتذارات وهولد</title>
<style>
 .madeby {
  position: fixed;
  top: 10px;
  right: 10px;
  color: #285eff; 
  background: #ffffffcc; 
  padding: 6px 14px;
  border-radius: 10px;
  font-size: 14px;
  font-family: 'Cairo', sans-serif;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  opacity: 0.9;
  z-index: 99999;
  transition: opacity .6s ease, transform .6s ease, background .3s;
  cursor: pointer;
  user-select: none;
  pointer-events: auto;
}

.madeby:hover {
  opacity: 0;
  transform: translateY(-10px);
}

.madeby--hidden {
  opacity: 0;
  transform: translateY(-10px);
}


  @keyframes fadeIn {from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
  button {
    background: linear-gradient(45deg,#4b8cff,#72a9ff);
    border: none;
    color: white;
    padding: 10px 18px;
    border-radius: 10px;
    font-size: 15px;
    cursor: pointer;
    transition: .3s;
  }
  button:hover { transform: scale(1.05); background: linear-gradient(45deg,#3f7eff,#609dff); }
  .box {
    margin-top:14px;
    display: flex;
    justify-content: space-between;
    gap:10px;
  }
  .msg {
    background:#f3f7ff;
    border:1px solid #d8e5ff;
    border-radius:10px;
    padding:12px;
    flex:1;
    cursor:pointer;
    transition:.2s;
    min-height:90px;
    overflow-y:auto;
  }
  .msg:hover { background:#e9f1ff; }
  .popup {
    position: fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:#fff;
    border-radius:14px;
    box-shadow:0 8px 25px rgba(0,0,0,.2);
    padding:30px 40px;
    text-align:center;
    z-index:999;
    animation: pop .5s ease;
  }
  @keyframes pop {from{opacity:0;transform:translate(-50%,-60%)}to{opacity:1;transform:translate(-50%,-50%)}}
  .hidden{display:none;}
  .popup button{margin-top:20px;}
  .calc-box {
  display: flex;
  flex-direction: column;
  gap: 14px;
}
.calc-box input {
  padding: 12px;
  font-size: px;
  border-radius: 5px;
  border: 1px solid #c9dafd;
  outline: none;
  text-align: center;
  transition: .3s;
}
.calc-box input:focus {
  border-color: #5b8def;
  box-shadow: 0 0 0 3px #5b8def22;
}
.calc-buttons {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  gap: 10px;
}
.calc-result {
  background: #f3f7ff;
  border-radius: 10px;
  padding: 10px;
  font-weight: bold;
  text-align: center;
  border: 1px solid #e1e9ff;
}
.grid {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 12px 16px;
  align-items: center;
}
.call-box {
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 8px;
  background: #fff;
  color: #000;
  direction: ltr;
}
.actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 16px;
}
.btn {
  cursor: pointer;
  border: 1px solid #222;
  border-radius: 10px;
  padding: 10px 14px;
}
.btn.primary {
  background: #285eff;
  color: #fff;
  border: none;
}
textarea#output {
  width: 90%;
  min-height: 160px;
  resize: none;
  white-space: pre-wrap;
  border: 1px solid #c9dafd;
  border-radius: 10px;
  margin-top: 10px;
  padding: 10px;
}
.divider {
  margin: 20px 0;
  border: none;
  border-top: 1px solid #d8e5ff;
}

.solution {
  margin-top: 10px;
}

.solution-grid {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 10px 14px;
  align-items: center;
}

.solution-grid label {
  font-weight: 600;
  color: #285eff;
}

.solution-grid select,
.solution-grid input {
  padding: 8px;
  border: 1px solid #c9dafd;
  border-radius: 8px;
  font-size: 14px;
  outline: none;
}

.solution-grid select:focus,
.solution-grid input:focus {
  border-color: #5b8def;
  box-shadow: 0 0 0 2px #5b8def33;
}

.solution textarea {
  width: 100%;
  margin-top: 12px;
  min-height: 90px;
  resize: none;
  border: 1px solid #c9dafd;
  border-radius: 10px;
  padding: 8px;
}

.main-sections {
  display: flex;
  flex-wrap: nowrap; /* ما ينزل شيء */
  gap: 25px;
  justify-content: flex-start;
  align-items: stretch;
  overflow-x: auto; /* تمرير أفقي فقط لو الشاشة صغيرة */
  scroll-behavior: smooth;
  padding: 30px 20px;
  box-sizing: border-box;
  width: 100%;
  max-width: 100vw; /* يمنع التمدد الزايد */

  /* مظهر الشريط */
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.4) rgba(0,0,0,0.1);
}

.main-sections::-webkit-scrollbar {
  height: 8px;
}
.main-sections::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.08);
  border-radius: 10px;
}
.main-sections::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.4);
  border-radius: 10px;
  backdrop-filter: blur(5px);
}

/* البوكسات نفس العرض حتى ما تنزل */
.section {
  flex: 0 0 350px; /* 👈 عرض ثابت يمنع النزول */
  max-width: 350px;
}
/* 💎 الصناديق الزجاجية */
.section {
  flex: 1 1 340px;
  max-width: 360px;
  min-height: 520px; /* 👈 يثبت طول البوكس */
  background: rgba(255, 255, 255, 0.18);
  border: 1px solid rgba(255, 255, 255, 0.35);
  border-radius: 18px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
  padding: 24px;
  backdrop-filter: blur(14px);
  transition: all 0.35s ease;
  position: relative;
  overflow: hidden;
}

/* ✨ تأثير ناعم عند المرور */
.section:hover {
  transform: translateY(-6px);
  box-shadow: 0 12px 35px rgba(80, 150, 255, 0.35);
  border-color: rgba(255, 255, 255, 0.6);
}

/* 💡 لمعان زجاجي خفيف */
.section::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 18px;
  background: linear-gradient(145deg, rgba(255,255,255,0.22), rgba(255,255,255,0.05));
  opacity: 0.9;
  pointer-events: none;
}


/* 💎 ستايل زجاجي بحدود مضيئة ثابتة */
/* 🧊 الحقول */
.card select,
.card input,
.card textarea {
  background: rgba(255, 255, 255, 0.20);
  border: 1.5px solid rgba(150, 180, 255, 0.6);
  color: #111;
  border-radius: 12px;
  padding: 10px 12px;
  width: 100%;
  font-size: 15px;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.card select:focus,
.card input:focus,
.card textarea:focus {
  background: rgba(255, 255, 255, 0.3);
  border-color: rgba(120, 160, 255, 1);
  box-shadow: 0 0 10px rgba(120, 160, 255, 0.5);
  outline: none;
}

/* 💙 الأزرار */
.card .btn {
  border: none;
  padding: 10px 18px;
  border-radius: 14px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  background: linear-gradient(135deg, rgba(70, 120, 255, 0.9), rgba(120, 160, 255, 0.9));
  color: #fff;
  transition: all 0.3s ease;
  box-shadow: 0 4px 14px rgba(90, 140, 255, 0.35);
  backdrop-filter: blur(10px);
}
.card .btn:hover {
  background: linear-gradient(135deg, rgba(80, 130, 255, 1), rgba(140, 180, 255, 1));
  transform: scale(1.05);
}

/* ✨ تلميح النص */
.card .hint {
  text-align: center;
  font-size: 13px;
  color: #2e5fff;
  margin-top: 10px;
  opacity: 0.9;
}
/* 🎯 تصغير الطول لحقل Compensation مع الحفاظ على نفس المظهر */
#compensation {
  width: 85%;
  height: 34px; /* 👈 أقصر شوي فقط */
  padding: 6px 12px;
  font-size: 14px;
  border-radius: 10px;
  border: 1px solid rgba(200, 220, 255, 0.6);
  background: rgba(255, 255, 255, 0.15); /* 👈 نفس خلفية الزجاج */
  backdrop-filter: blur(12px);
  color: #1a1a1a;
  outline: none;
  transition: all 0.3s ease;
}

/* ✨ تأثير عند التفاعل */
#compensation:hover,
#compensation:focus {
  border-color: rgba(91, 141, 239, 0.9);
  box-shadow: 0 0 10px rgba(91, 141, 239, 0.25);
  
}
/* 💰 زر التعويض */
#compensationBtn {
  all: unset !important;
  display: inline-block !important;
  background: rgba(15, 25, 60, 0.8) !important;
  border: 1px solid rgba(255, 255, 255, 0.25) !important;
  color: #fff !important;
  border-radius: 12px !important;
  padding: 10px 22px !important;
  font-family: 'Cairo', sans-serif !important;
  font-size: 15px !important;
  font-weight: 600 !important;
  cursor: pointer !important;
  transition: all 0.3s ease !important;
  backdrop-filter: blur(12px) !important;
  -webkit-backdrop-filter: blur(12px) !important;
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.35) !important;
  text-align: center !important;
}
#compensationBtn:hover {
  background: rgba(50, 70, 150, 0.9) !important;
  box-shadow: 0 0 15px rgba(90, 150, 255, 0.5) !important;
  transform: scale(1.06) !important;
}

/* 💳 زر الاسترداد */
#refundcompBtn {
  all: unset !important;
  display: inline-block !important;
  background: rgba(50, 20, 10, 0.8) !important;
  border: 1px solid rgba(255, 255, 255, 0.25) !important;
  color: #fff !important;
  border-radius: 12px !important;
  padding: 10px 22px !important;
  font-family: 'Cairo', sans-serif !important;
  font-size: 15px !important;
  font-weight: 600 !important;
  cursor: pointer !important;
  transition: all 0.3s ease !important;
  backdrop-filter: blur(12px) !important;
  -webkit-backdrop-filter: blur(12px) !important;
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.35) !important;
  text-align: center !important;
}
#refundcompBtn:hover {
  background: rgba(110, 40, 20, 0.9) !important;
  box-shadow: 0 0 15px rgba(255, 180, 100, 0.5) !important;
  transform: scale(1.06) !important;
}

#refundBtn {
  all: unset !important;
  display: inline-block !important;
  background: rgba(179, 67, 30, 0.8) !important;
  border: 1px solid rgba(255, 255, 255, 0.25) !important;
  color: #fff !important;
  border-radius: 12px !important;
  padding: 10px 22px !important;
  font-family: 'Cairo', sans-serif !important;
  font-size: 15px !important;
  font-weight: 600 !important;
  cursor: pointer !important;
  transition: all 0.3s ease !important;
  backdrop-filter: blur(12px) !important;
  -webkit-backdrop-filter: blur(12px) !important;
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.35) !important;
  text-align: center !important;
}
#refundBtn:hover {
  background: rgba(110, 40, 20, 0.9) !important;
  box-shadow: 0 0 15px rgba(255, 180, 100, 0.5) !important;
  transform: scale(1.06) !important;
}
</style>
</head>
<body>
 <script>
async function checkVersion() {
  try {
    const res = await fetch("version.json?nocache=" + Date.now());
    const data = await res.json();

    const currentVersion = "1.0.3"; // ← غيّر رقم النسخة الحالية في صفحتك

    // 🔹 إذا وجد نسخة جديدة، أظهر التنبيه مرة واحدة فقط
    if (data.version.trim() !== currentVersion.trim() && !document.getElementById("updateNotice")) {
      showUpdateNotice();
    }
  } catch (e) {
    console.log("⚠️ فشل التحقق من النسخة:", e);
  }
}

function showUpdateNotice() {
  // 🔹 إنشاء العنصر الزجاجي
  const notice = document.createElement("div");
  notice.id = "updateNotice";
  notice.innerHTML = `
    <div class="update-glass">
      <h3>✨ يامعلم حدثنا النظام</h3>
      <p>الله لايهينك اكبس  <b>Enter</b> خنحدث هلصفحه </p>
    </div>
  `;
  document.body.appendChild(notice);

  // 🔹 عند الضغط على Enter يتم التحديث
  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      location.reload(true);
    }
  });
}

// ⏳ التحقق كل 20 ثانية (يمكنك زيادتها)
setInterval(checkVersion, 5000);
</script>

<style>
/* 🧊 صندوق التحديث الزجاجي */
.update-glass {
  position: fixed;
  bottom: 25px;
  right: 25px;
  background: rgba(255, 255, 255, 0.25);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.4);
  border-radius: 20px;
  padding: 18px 26px;
  text-align: center;
  color: #1c2742;
  font-family: 'Cairo', sans-serif;
  min-width: 260px;
  box-shadow: 0 6px 25px rgba(0,0,0,0.25);
  z-index: 99999;
  animation: glassFade 0.8s ease forwards, gentlePulse 3s ease-in-out infinite;
}

.update-glass h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 700;
  color: #003cff;
}

.update-glass p {
  margin: 5px 0 0 0;
  font-size: 14px;
  color: #243b70;
}

/* ✨ الدخول الناعم */
@keyframes glassFade {
  from {opacity: 0; transform: translateY(15px) scale(0.95);}
  to {opacity: 1; transform: translateY(0) scale(1);}
}

/* 💫 اهتزاز ناعم متكرر */
@keyframes gentlePulse {
  0%, 100% { transform: scale(1); box-shadow: 0 0 15px rgba(0, 120, 255, 0.25); }
  50% { transform: scale(1.02); box-shadow: 0 0 25px rgba(0, 120, 255, 0.5); }
}
</style>
  <div class="madeby">Made by Abdelrahman & Reem </div>
  <!-- 🕒 ساعة الأردن (12 ساعة) -->
<div id="jordanClock">🕒 00:00:00 AM</div>
<style>
  #jordanClock {
    position: fixed;
    top: 10px;
    right: 260px;
    color: #285eff;
    background: rgba(255, 255, 255, 0.25);
    border: 1px solid rgba(40, 94, 255, 0.4);
    border-radius: 12px;
    padding: 8px 16px;
    font-size: 22px;
    font-family: 'Cairo', sans-serif;
    font-weight: 700;
    backdrop-filter: blur(12px) saturate(180%);
    -webkit-backdrop-filter: blur(12px) saturate(180%);
    box-shadow: 0 3px 15px rgba(40, 94, 255, 0.25);
    z-index: 99999;
    user-select: none;
    animation: fadeInClock 1s ease, floatClock 3s ease-in-out infinite alternate;
  }

  @keyframes fadeInClock {
    from { opacity: 0; transform: translateY(-15px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes floatClock {
    from { transform: translateY(0px); }
    to { transform: translateY(-6px); }
  }
</style>

<script>
function updateJordanClock() {
  const now = new Date();
  const jordanTime = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Amman" }));
  
  let hours = jordanTime.getHours();
  const minutes = String(jordanTime.getMinutes()).padStart(2, "0");
  const seconds = String(jordanTime.getSeconds()).padStart(2, "0");
  const ampm = hours >= 12 ? "PM" : "AM";
  
  hours = hours % 12;
  hours = hours ? hours : 12; // إذا كانت 0 نخليها 12
  
  document.getElementById("jordanClock").textContent = `🕒 ${hours}:${minutes}:${seconds} ${ampm}`;
}

setInterval(updateJordanClock, 1000);
updateJordanClock();
</script>
<div class="main-sections">
<!-- القسم الأيمن -->
<div class="section" id="apology">
  <h2 style="color:#285eff;">قسم الاعتذارات</h2>

  <h3 style="color:#285eff;">الاعتذارات الطويلة</h3>
  <button onclick="generate('longApology')">توليد اعتذار طويل</button>
  <div class="box">
    <div class="msg" id="longAr" onclick="copyText('longAr')"></div>
    <div class="msg" id="longEn" onclick="copyText('longEn')"></div>
  </div>
  <h3 style="color:#285eff;">الاعتذارات القصيرة</h3>
  <button onclick="generate('shortApology')">توليد اعتذار قصير</button>
  <div class="box">
    <div class="msg" id="shortAr" onclick="copyText('shortAr')"></div>
    <div class="msg" id="shortEn" onclick="copyText('shortEn')"></div>

 </div>
 

  <h2>🔹 هولد المطعم</h2>
  <div class="fixed-hold-cards">
  <div class="hold-card" onclick="copyMsg(this)">
    ممكن تعطيني دقيقتين - ثلاث دقائق لاتواصل مع المطعم ؟ شكرا لتفهمك وصبرك.</div>

  <div class="hold-card" onclick="copyMsg(this)">
   Could you please give me 2–3 minutes to contact the the merchant ? Thank you for your understanding and patience</div>

</div>

 <h2>🔹 هولد المندوب</h2>
  <div class="fixed-hold-cards">
  <div class="hold-card" onclick="copyMsg(this)">
    ممكن تعطيني دقيقتين - ثلاث دقائق لاتواصل مع السائق ؟ شكرا لتفهمك وصبرك.</div>

  <div class="hold-card" onclick="copyMsg(this)">
  Could you please give me 2–3 minutes to contact the the rider ? Thank you for your understanding and patience</div>
   
</div>
<h3>🔹 الغاء الطلب </h3>
  <div class="fixed-hold-cards">
  <div class="hold-card" onclick="copyMsg(this)">
    بعد ما تفاهمت مع المطعم، راح ألغي لك الطلب. تقدر تسوي طلب جديد ولا يهمك.</div>

  <div class="hold-card" onclick="copyMsg(this)">
  After negotiating with the restaurant, I will proceed to cancel the order for you. You can place a new order.</div>
  </div>
  
   <h5>🔹 ماوافق  </h5>
  <div class="fixed-hold-cards">
  <div class="hold-card" onclick="copyMsg(this)">
    نعتذر، المطعم بدأ بتجهيز الطلب، فما يمدينا نلغيه</div>

  <div class="hold-card" onclick="copyMsg(this)">
  We apologize, but the merchant has already started preparing the food, so the order cannot be canceled</div>
   </div>
  
</div>

<!-- القسم الأيسر -->
 
<div class="section" id="hold">
  <h2 style="color:#285eff;">قسم الهولد</h2>
  <button onclick="generate('hold')">توليد هولد</button>
  <div class="box">
    <div class="msg" id="holdAr" onclick="copyText('holdAr')"></div>
    <div class="msg" id="holdEn" onclick="copyText('holdEn')"></div>
  </div>
  <!-- كروت سكربتات ثابتة للهولد -->
<div class="fixed-hold-cards">
  <div class="hold-card" onclick="copyMsg(this)">
    ممكن دقيقة من فضلك عشان أشيك لك على الموضوع؟
شكراً على صبرك.


  </div>
  <div class="hold-card" onclick="copyMsg(this)">
   Could you please give me a minute to check on this for you? Thank you for your patience.
  </div>
</div>

  <div style="color:#9a1b1b;" class="fixed-hold-cards">
  <div class="hold-card" onclick="copyMsg(this)">
   شكرا على صبرك
  </div>
  <div class="hold-card" onclick="copyMsg(this)">
 Thank you for your patience
  </div>
</div>

<style>
.fixed-hold-cards {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}
.hold-card {
  flex: 1;
  background: #e8f1ff;
  border: 1px solid #e5efff;
  border-radius: 8px;
  padding: 10px;
  cursor: pointer;
  text-align: center;
  font-size: 13px;
  transition: 0.3s;
}
.hold-card:hover {
  background: #e5efff;
  transform: scale(1.03);
}
</style>
  
  <!-- قسم السولوشن -->
 <div class="card">
  <h2 style="color:#285eff;">قسم السولوشن </h2>

  <div class="grid">
    <!-- 🧩 Call Line -->
    <label for="callType">Call line</label>
    <select id="callType" onchange="toggleCallInput()">
      <option value="none">اختر نوع المكالمة</option>
      <option value="noneed"selected>No need</option>
      <option value="merchant">Merchant</option>
      <option value="rider">Rider</option>
    </select>

    <div id="callResultBox" style="display:none; grid-column: 1 / span 2;">
      <label for="callResult">Call Result</label>
      <input id="callResult" type="text" placeholder="اكتب نتيجة المكالمة هنا" />
    </div>

    <!-- 🧩 Risk Label -->
    <label for="riskLabel">Case Solution Risk Label</label>
    <select id="riskLabel" onchange="toggleRCOptions()">
      <option value="">Select</option>
      <option value="0RC"selected>0RC</option>
      <option value="1RC">1RC</option>
      <option value="2RC">2RC</option>
      <option value="3RC">3RC</option>
      <option value="3RC>">3RC></option>
      <option value="Red">Red</option>
      <option value="Purple">Purple</option>
    </select>

    <!-- 🔹 يظهر فقط مع Red أو Purple -->
    <div id="rcOptions" style="display:none; grid-column:1 / span 2; margin-top:8px;">
      <label style="font-weight:bold; color:#285eff;">اختر RC</label>
      <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:6px;">
        <label><input type="radio" name="subRC" value="0RC">0RC</label>
        <label><input type="radio" name="subRC" value="1RC">1RC</label>
        <label><input type="radio" name="subRC" value="2RC">2RC</label>
        <label><input type="radio" name="subRC" value="3RC">3RC</label>
        <label><input type="radio" name="subRC" value="3RC>">3RC></label>
      </div>
    </div>

    <label for="evidence">Evidence</label>
    <select id="evidence">
      <option value="Clear" >Clear</option>
      <option value="Unclear"selected>Unclear</option>
      <option value="No need"selected>No need</option>
    </select>

    <label for="receipt">Receipt</label>
    <select id="receipt">
      <option value="yes">yes</option>
      <option value="no">no</option>
      <option value="No need"selected>No need</option>
    </select>

    <label for="refund">Refund</label>
    <select id="refund">
      
      <option value="No refund"selected>No refund</option>
      <option value="Partial refund">Partial refund</option>
      <option value="Full refund">Full refund</option>
    </select>

    <label for="compensation">Compensation (قيمة التعويض لو مافي اتركها فاضيه)</label>
    <input id="compensation" type="text" inputmode="decimal" placeholder="اكتب المبلغ أو اتركها فاضية" />
  </div>

  <div class="actions">
    <button class="btn primary" id="build">صنع الحل</button>
    <button class="btn" id="clear">مسح</button>
  </div>

  <textarea id="output" readonly placeholder="بس تخلص اضغط علي"></textarea>
  <div class="hint">كبسه على الحقل ينسخ كلشي</div>
</div>
 </div>
  <!-- القسم الثالث -->
<!-- سكربتات المحادثة (نسخة مضغوطة) -->
<div class="section" id="chatScriptsSimple" style="width:500px; padding:16px;">
  <h2 style="text-align:center; color:#285eff; margin-bottom:12px;">سكربتات المحادثة</h2>

  <!-- الترحيب -->
  <div class="chat-block" style="background:#f1f6ff; border-radius:10px; padding:10px; margin-bottom:10px;">
    <h3 class="chat-title" style="color:#285eff;">👋 الترحيب</h3>
    <div class="chat-row">
      <div class="msg" onclick="copyMsg(this)">مرحبا كيف بقدر اساعدك اليوم؟</div>
      <div class="msg" onclick="copyMsg(this)">Hello, how can I help you today?</div>
    </div>
    <div class="chat-row">
      <div class="msg" onclick="copyMsg(this)">مرحبا انا هنا لمساعدتك</div>
      <div class="msg" onclick="copyMsg(this)">Hello, I am here to help you.</div>
    </div>
  </div>

  <!-- الاعتذار والتأكيد -->
  <div class="chat-block" style="background:#eaf9f3; border-radius:10px; padding:10px; margin-bottom:10px;">
    <h3 class="chat-title" style="color:#009a61;">🍽️ الاعتذار والتأكيد</h3>
<div style="text-align:center; margin-bottom:15px;">
  <input type="text" id="restaurantName" placeholder="اكتب اسم المطعم هنا" 
         style="padding:8px 12px; border:1px solid #ccc; border-radius:8px; width:60%; max-width:300px; text-align:center;">
</div>
   
    <div class="chat-row">
      <div class="msg" onclick="copyMsg(this)">
  آسف جدًا على أي إزعاج صار معك. هل تقصد طلبك الأخير من مطعم (      ) ؟
</div>

<div class="msg" onclick="copyMsg(this)">
  I’m very sorry for any inconvenience. Are you referring to your most recent order from the restaurant (      )?
</div>
</div>  
    <div class="chat-row">
      <div class="msg" onclick="copyMsg(this)">أنا آسف جداً على المشكلة اللي حصلت لك</div>
      <div class="msg" onclick="copyMsg(this)">I am very sorry for the inconvenience you have experienced.</div>
    </div>
  </div>

  <!-- أي خدمة إضافية -->
  <div class="chat-block" style="background:#fff6e5; border-radius:10px; padding:10px; margin-bottom:10px;">
    <h3 class="chat-title" style="color:#c77b00;">❓ خدمة إضافية</h3>
    <div class="chat-row">
      <div class="msg" onclick="copyMsg(this)">اي خدمه ثانيه يمكنني مساعدتك بها عميلنا العزيز ؟</div>
      <div class="msg" onclick="copyMsg(this)">Is there anything else I can help you with?</div>
    </div>
    <div class="chat-row">
      <div class="msg" onclick="copyMsg(this)">مرحبًا. لم نتلق ردك بعد، وسيتم إغلاق المحادثة قريبًا. إذا كان عندك أي استفسار آخر، لا تتردد بالتواصل معنا.</div>
      <div class="msg" onclick="copyMsg(this)">Hello! We haven’t received your response yet. The chat will close soon. Feel free to contact us anytime.</div>
    </div>
  </div>

  <!-- الختامية -->
  <div class="chat-block" style="background:#f8eefc; border-radius:10px; padding:10px;">
    <h3 class="chat-title" style="color:#7b2cbf;">✅ الختامية</h3>
    <div class="chat-row">
      <div class="msg" onclick="copyMsg(this)">شكراً لتواصلك مع خدمة عملاء كيتا. راح نكون شاكرين لو تقدر تأخذ لحظة لتقييم خدمتنا. شكراً لتعاونك، ونتمنى لك يوماً سعيد</div>
      <div class="msg" onclick="copyMsg(this)">Thank you for contacting Keeta customer service. We appreciate it if you could take a moment to rate our service. ​Have a great day!</div>
    </div>
<div class="chat-row">
    <div class="msg" onclick="copyMsg(this)">سُعدتُ بخدمتك اليوم. بعد انتهاء المحادثة سيظهر لك إشعار لتقييم تجربتك معنا، ونود إبلاغك أن التقييم يكون من 1 إلى 5، حيث 5 هو أعلى تقييم و1 هو الأقل. نشكر تواصلك مع كيتا ونتمنى لك يوماً سعيداً.</div>
      <div class="msg" onclick="copyMsg(this)">I am happy to serve you today. After the end of the conversation,a message will appear to evaluate your experience, and it will inform you that the rating will be from 1 to 5, where 5 is the highest rating and 1 is the lowest. Thank you for contacting Keeta and I wish you a happy day.</div>
</div>
  </div>
</div>

<style>
.chat-row {
  display: flex;
  justify-content: space-between;
  gap: 6px;
  margin-bottom: 6px;
}
.msg {
  background: #fff;
  border: 1px solid #d8e5ff;
  border-radius: 8px;
  padding: 6px 8px;
  flex: 1;
  font-size: 12px;
  line-height: 1.4;
  cursor: pointer;
  transition: 0.25s;
  min-height: 45px;
  display: flex;
  align-items: center;
}
.msg:hover {
  background: #e9f1ff;
  transform: scale(1.02);
}
.chat-title {
  margin-bottom: 6px;
  font-size: 14px;
  font-weight: bold;
}
</style>

<script>
// 🎯 دالة النسخ الذكية (تتعامل مع كل أنواع الأقواس)
function copyMsg(el) {
  // ناخذ النص داخل العنصر
  let text = el.textContent.trim();

  // نجيب اسم المطعم من الحقل
  const restaurantField = document.getElementById("restaurantName");
  const restaurant = restaurantField ? restaurantField.value.trim() : "";

  // 🔹 نستبدل أي أقواس فيها فراغات أو شرطات أو نقاط أو خطوط تحت
  if (restaurant) {
    text = text.replace(/\(\s*[^\)]*\s*\)/, "(" + restaurant + ")");
  }

  // نسخ النص
  navigator.clipboard.writeText(text);

  // إظهار إشعار تم النسخ
  showCopiedNotice();
}

// 🎯 دالة عرض الإشعار
function showCopiedNotice() {
  let note = document.getElementById("copyNotice");
  if (!note) {
    note = document.createElement("div");
    note.id = "copyNotice";
    note.textContent = "✅ تم النسخ";
    Object.assign(note.style, {
      position: "fixed",
      bottom: "20px",
      right: "20px",
      background: "#285eff",
      color: "#fff",
      padding: "8px 14px",
      borderRadius: "8px",
      fontFamily: "Cairo, sans-serif",
      fontSize: "14px",
      opacity: "0",
      transition: "opacity .3s ease",
      zIndex: "99999"
    });
    document.body.appendChild(note);
  }

  note.style.opacity = "1";
  setTimeout(() => (note.style.opacity = "0"), 1200);
}
</script>
<!-- 🟦 القسم الرابع: التعويض والاسترداد -->
<div class="section" id="compensationSection" style="flex:1; min-width:350px; max-width:480px;">
  <h2 style="text-align:center; color:#285eff;"> قسم التعويض والاسترداد</h2>

  
  <div class="actions" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-bottom:10px;">
    <button id="compensationBtn" class="btn primary" onclick="startCompensation()">تعويض</button>
    <button id="refundcompBtn" class="btn" onclick="startRefund()">استرداد وتعويض</button>
    <button id="refundBtn" class="btn" style="background:#2c5679; color:#fff;" onclick="startOnlyRefund()">استرداد</button>
    <div id="scriptBox" style="margin-top:10px;"></div>
  </div>

<!-- الآلة الحاسبة داخل قسم الاعتذارات -->
 
<div class="calc-box" style="margin-top: 20px; border-top: 1px solid #d8e5ff; padding-top: 16px;">
  <h3 style="color:#285eff; margin-bottom:8px; text-align:center;">🔢 الآلة الحاسبة</h3>
  <input id="calcInput" type="number" placeholder="أدخل الرقم" style="padding:10px;border:1px solid #c9dafd;border-radius:8px;width:90;text-align:center;font-size:15px;">
  <div class="calc-buttons" style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px;">
    <button onclick="calc(0.8)">Main dish</button>
    <button onclick="calc(0.5)">Side dish</button>
    <button onclick="calc(0.3)">Drink</button>
    <button onclick="calc(0.1)">Cutlery</button>
  </div>
  <div id="calcResult" class="calc-result" style="background:#f3f7ff;border-radius:8px;padding:8px;margin-top:10px;text-align:center;font-weight:bold;border:1px solid #e1e9ff;">
    النتيجة: —
  </div>

</div>
<script>
// دالة النسخ الذكية 👇
document.addEventListener("click", function (e) {
  const el = e.target.closest(".msgBox");
  if (!el) return;

  // النص الأصلي
  let text = el.textContent;

  // قراءة القيم من الحقول الحالية
  const refVal = document.querySelector("#refundValue")?.value.trim() || "";
  const compMain = document.querySelector("#compValue")?.value.trim() || "";
  const compAlt = document.querySelector("#compValue2")?.value.trim() || "";

  // استبدال الأقواس مهما كانت المسافات
  const matches = [...text.matchAll(/\([\s\S]*?\)/g)];
  if (matches.length) {
    if (matches[0]) text = text.replace(matches[0][0], `(${refVal || compMain || "—"})`);
    if (matches[1]) text = text.replace(matches[1][0], `(${compAlt || compMain || "—"})`);
  }

  // نسخ للنص النهائي
  navigator.clipboard.writeText(text.trim());

  // تأثير بسيط
  el.style.background = "#cde6ff";
  setTimeout(() => (el.style.background = "#fff"), 300);

  // إشعار النسخ
  showCopyAlert(e.pageX, e.pageY);
});

function showCopyAlert(x, y) {
  let note = document.getElementById("copyAlert");
  if (!note) {
    note = document.createElement("div");
    note.id = "copyAlert";
    note.textContent = "✔ تم النسخ";
    Object.assign(note.style, {
      position: "absolute",
      background: "#285eff",
      color: "#fff",
      padding: "5px 10px",
      borderRadius: "6px",
      fontSize: "13px",
      fontFamily: "Cairo, sans-serif",
      zIndex: "999999",
      opacity: "0",
      transition: "opacity .3s ease, transform .3s ease",
      pointerEvents: "none",
    });
    document.body.appendChild(note);
  }

  note.style.left = `${x + 15}px`;
  note.style.top = `${y - 10}px`;
  note.style.opacity = "1";
  note.style.transform = "translateY(-8px)";
  setTimeout(() => {
    note.style.opacity = "0";
    note.style.transform = "translateY(0)";
  }, 1000);
}

// 🔹 تعويض فقط

function startCompensation() {
  const box = document.getElementById('scriptBox');
  box.innerHTML = `
    <h2 style="color:#285eff;"> قسم التعويض</h2>

    <!-- سكربت عربي -->
    <div class="msgBox" onclick="copyText(this)" 
      style="background:#f7faff;border:1px solid #d6e4ff;
      padding:10px;margin-top:10px;border-radius:10px;cursor:pointer;">
      نأسف للإزعاج. نعتذر عن ذلك، وسنقوم بتعويضك بمبلغ إجمالي قدره (      ) ريال سعودي.
    </div>

    <!-- سكربت إنجليزي -->
    <div class="msgBox" onclick="copyText(this)" 
      style="background:#f7faff;border:1px solid #d6e4ff;
      padding:10px;margin-top:8px;border-radius:10px;cursor:pointer;">
      Sorry for the inconvenience. To express our apologies, we can apply total of (      ) SAR compensation to your account.
    </div>

    <!-- حقل القيمة -->
    <input type="number" id="compValue" placeholder="قيمة التعويض (اختياري)" 
      style="margin-top:12px;padding:8px;border:1px solid #ccc;
      border-radius:8px;width:90%;">

    <!-- 🔹 سكربتات المحفظة الخاصة بالتعويض -->
    <div class="msgBox" onclick="copyText(this)" 
      style="background:#eaf9f3;border:1px solid #cceedd;
      color:#006b3b;padding:10px;margin-top:16px;border-radius:10px;
      cursor:pointer;font-weight:500;">
     راح نضيف التعويض لمحفظة كيتا الخاصة بك على الفور. الرصيد ما له صلاحية وتقدر تستخدمه على الطلبات المؤهلة.
    </div>

    <div class="msgBox" onclick="copyText(this)" 
      style="background:#eaf9f3;border:1px solid #cceedd;
      color:#006b3b;padding:10px;margin-top:8px;border-radius:10px;
      cursor:pointer;font-weight:500;">
     Your compensation will be added to your Keeta wallet immediately. The balance won't expire and can be used for eligible orders.
    </div>

    <!-- زر إعادة -->
    <div style="text-align:center;margin-top:15px;">
      <button class="btn primary" 
        style="background:#285eff;color:#fff;border:none;
        padding:10px 20px;border-radius:8px;cursor:pointer;" 
        onclick="resetComp()">🔄 إعادة من البداية</button>
    </div>
  `;
}


// 🔸 استرداد وتعويض

function startRefund() {
  const box = document.getElementById('scriptBox');
  box.innerHTML = `
    <h2 style="color:#285eff;"> قسم الاسترداد والتعويض</h2>

    <!-- سكربت عربي -->
    <div class="msgBox" onclick="copyText(this)" 
      style="background:#f7faff;border:1px solid #d6e4ff;
      padding:10px;margin-top:10px;border-radius:10px;cursor:pointer;">
      نأسف للإزعاج. يمكننا استرداد مبلغ (      ) ريال سعودي لطلبك فورًا، 
      مع إضافة مبلغ إجمالي قدره (      ) ريال سعودي كتعويض.
    </div>

    <!-- سكربت إنجليزي -->
    <div class="msgBox" onclick="copyText(this)" 
      style="background:#f7faff;border:1px solid #d6e4ff;
      padding:10px;margin-top:8px;border-radius:10px;cursor:pointer;">
      Sorry for the inconvenience. We can refund (      ) SAR 
      and apply total of (      ) SAR compensation.
    </div>

    <!-- 🔹 الحقول -->
    <input type="number" id="refundValue" placeholder="قيمة الاسترداد" 
      style="margin-top:12px;padding:8px;border:1px solid #ccc;
      border-radius:8px;width:90%;">
    <input type="number" id="compValue2" placeholder="قيمة التعويض" 
      style="margin-top:8px;padding:8px;border:1px solid #ccc;
      border-radius:8px;width:90%;">

    <!-- 🔴 السكربتات الجديدة (لون أحمر) -->
    <div class="msgBox" onclick="copyText(this)" 
      style="background:#ffeaea;border:1px solid #ffb3b3;
      color:#b30000;padding:10px;margin-top:16px;border-radius:10px;
      cursor:pointer;font-weight:500;">
      أعتذر بصدق عن الإزعاج الذي تسببنا به. 
      سنقوم بمعالجة استرداد المبلغ إلى محفظتك على الفور، 
      وسيكون متاحًا مباشرة.<br>هل تفضل ذلك؟
    </div>

    <div class="msgBox" onclick="copyText(this)" 
      style="background:#ffeaea;border:1px solid #ffb3b3;
      color:#b30000;padding:10px;margin-top:8px;border-radius:10px;
      cursor:pointer;font-weight:500;">
      I sincerely apologize for the inconvenience caused. 
      We will process a refund to your wallet right away, 
      and it will be available immediately.<br>Do you prefer this?
    </div>

    <!-- 🔘 الأزرار -->
    <div style="margin-top:14px;">
      <button class="btn primary" 
        style="background:#285eff;color:#fff;border:none;
        padding:8px 18px;border-radius:8px;cursor:pointer;" 
        onclick="walletFlow()">محفظة</button>

      <button class="btn secondary" 
        style="background:#00b36b;color:#fff;border:none;
        padding:8px 18px;border-radius:8px;cursor:pointer;" 
        onclick="originalFlow()">الطريقة الأصلية</button>
    </div>

    <!-- 🔁 زر إعادة -->
    <div style="text-align:center;margin-top:15px;">
      <button class="btn primary" 
        style="background:#285eff;color:#fff;border:none;
        padding:10px 20px;border-radius:8px;cursor:pointer;" 
        onclick="resetComp()">🔄 إعادة من البداية</button>
    </div>
  `;
}



// 🔹 خيار المحفظة
function walletFlow() {
  document.getElementById('extraScripts')?.remove();
  const box = document.getElementById('scriptBox');
  const div = document.createElement('div');
  div.id = 'extraScripts';
  div.innerHTML = `
    <div class="msg" onclick="copyMsg(this)" style="background:#eaf9f3;">
راح نضيف التعويض لمحفظة كيتا الخاصة بك على الفور. الرصيد ما له صلاحية وتقدر تستخدمه على الطلبات المؤهلة.
    </div>
    <div class="msg" onclick="copyMsg(this)" style="background:#eaf9f3;">
Your compensation will be added to your Keeta wallet immediately. The balance won't expire and can be used for eligible orders.
    </div>
  `;
  box.appendChild(div);
}

// 🔸 خيار الطريقة الأصلية

function originalFlow() {
  // نحذف أي سكربتات مضافة مسبقًا
  document.getElementById('extraScripts')?.remove();

  const box = document.getElementById('scriptBox');

  // ننشئ الحاوية الجديدة
  const div = document.createElement('div');
  div.id = 'extraScripts';
  div.style.marginTop = '12px';
  div.style.display = 'grid';
  div.style.gap = '10px';

  // سكربتات الطريقة الأصلية الأساسية
  const mainScriptsHTML = `
    <div class="msg" onclick="copyMsg(this)" style="background:#fff6e5; border:1px solid #f7d9a2; padding:10px; border-radius:10px; cursor:pointer;">
  تمام، الحين بنرجع لك مبلغ الاسترجاع والتعويض على طريقة الدفع اللي استخدمتها، وسيظهر المبلغ في حسابك خلال أيام، إذا لم يظهر المبلغ خلال 10 أيام، نرجو الاتصال بالبنك الخاصة بعملية الدفع لمساعدتك.
    </div>
    <div class="msg" onclick="copyMsg(this)" style="background:#fff6e5; border:1px solid #f7d9a2; padding:10px; border-radius:10px; cursor:pointer;">
     We will process the refund and compensation back to your original payment method. The amount would be reflected in your account within a few days. If it hasn't appeared within 10 days, please contact your payment provider for help
    </div>
  `;

  // ✅ سكربتات إضافية (لون أحمر - حالة الاسترداد)
  const extraScriptHTML = `
    <div class="msg" onclick="copyMsg(this)" style="
      background:#ffeaea;
      border:1px solid #ffb3b3;
      color:#b30000;
      margin-top:18px;
      border-radius:10px;
      padding:10px;
      cursor:pointer;
      font-weight:500;
    ">
      لا يزال الاسترداد ضمن فترة المعالجة، نرجو منك الانتظار بصبر. يمكنك أيضًا الحصول على رقم ARN/RRN من قسم "تتبع استردادي" للتواصل مع بنكك المصدر والتحقق من حالة المبلغ.
    </div>

    <div class="msg" onclick="copyMsg(this)" style="
      background:#ffeaea;
      border:1px solid #ffb3b3;
      color:#b30000;
      border-radius:10px;
      padding:10px;
      cursor:pointer;
      font-weight:500;
    ">
      It's still within the refund process timeline, please wait patiently. You also can have the ARN/RRN in "track my refund" to contact your issuer bank to check the status of money.
    </div>
  `;

  // نجمع الكل
  div.innerHTML = mainScriptsHTML + extraScriptHTML;

  // نضيفهم بعد أزرار المحفظة والطريقة الأصلية مباشرة
  const buttons = box.querySelector('.action-buttons');
  if (buttons) {
    buttons.insertAdjacentElement('afterend', div);
  } else {
    box.appendChild(div);
  }
}

// 🔁 إعادة من البداية
function resetComp() {
  const box = document.getElementById('scriptBox');
  box.innerHTML = '';
}
// 🟩 قسم "استرداد فقط"
// 🟩 قسم "استرداد فقط" بدون حقل، مع فاصل بين العادي والحمر
// 🟩 قسم "استرداد فقط" (بدون حقل، مع فاصل وزر إعادة)
function startOnlyRefund() {
  const box = document.getElementById('scriptBox');
  box.innerHTML = `
    <h2 style="color:#285eff;">قسم الاسترداد فقط</h2>

    <!-- سكربت عربي -->
    <div class="msgBox" onclick="copyMsg(this)" 
      style="background:#f7faff;border:1px solid #d6e4ff;
      padding:10px;margin-top:10px;border-radius:10px;cursor:pointer;">
      نعتذر عن التجربة الغير مرضية. يمكننا إعادة المبلغ فوراً بقيمة (      ) ريال سعودي لطلبك
    </div>

    <!-- سكربت إنجليزي -->
    <div class="msgBox" onclick="copyMsg(this)" 
      style="background:#f7faff;border:1px solid #d6e4ff;
      padding:10px;margin-top:8px;border-radius:10px;cursor:pointer;">
      Sorry for the inconvenience. We can refund (      ) SAR for your order right away
    </div>

    <!-- 🔹 فاصل أنيق -->
    <hr style="border:none; border-top:1px dashed #ccc; margin:18px 0;">

    <!-- سكربتات الحمراء -->
    <div class="msgBox" onclick="copyMsg(this)" 
      style="background:#ffeaea;border:1px solid #ffb3b3;
      color:#b30000;padding:10px;border-radius:10px;
      cursor:pointer;font-weight:500;">
      أعتذر بصدق عن الإزعاج الذي تسببنا به. 
      سنقوم بمعالجة استرداد المبلغ إلى محفظتك على الفور، 
      وسيكون متاحًا مباشرة.<br>هل تفضل ذلك؟
    </div>

    <div class="msgBox" onclick="copyMsg(this)" 
      style="background:#ffeaea;border:1px solid #ffb3b3;
      color:#b30000;padding:10px;margin-top:8px;border-radius:10px;
      cursor:pointer;font-weight:500;">
      I sincerely apologize for the inconvenience caused. 
      We will process a refund to your wallet right away, 
      and it will be available immediately.<br>Do you prefer this?
    </div>

    <!-- الأزرار -->
    <div style="margin-top:14px;">
      <button class="btn primary" style="background:#285eff;color:#fff;" onclick="walletFlow()">محفظة</button>
      <button class="btn secondary" style="background:#00b36b;color:#fff;" onclick="originalFlow()">الطريقة الأصلية</button>
    </div>

    <!-- 🔄 زر إعادة من البداية -->
    <div style="text-align:center;margin-top:20px;">
      <button class="btn primary" 
        style="background:#285eff;color:#fff;border:none;
        padding:10px 20px;border-radius:8px;cursor:pointer;" 
        onclick="resetComp()">🔄 البدء من جديد</button>
    </div>
  `;
}

</script>



</div> <!-- نهاية main-sections -->


<!-- popup -->
<div id="popup" class="popup hidden">
  <p id="popupMsg"></p>
  <button onclick="resetLists()">🔄 توليد من البداية</button>
</div>

<script>
const longApology = [
  {ar:`نعتذر من أعماق قلبنا عن أي إزعاج قد تسببت به تجربتك، ونحن نقدر تماماً مشاعرك. نحن نأخذ ملاحظاتك بكل جدية ونعمل جاهدين على نقلها إلى المطعم لتحسين الخدمة وتقديم الأفضل دائمًا. هدفنا هو أن نمنحك تجربة استثنائية تتناسب مع توقعاتك وتفوقها في المستقبل. نحن نسعى دائماً لإرضائك، ونتمنى أن نتمكن من استعادة ثقتك الغالية فينا. شكراً لك على دعمك وصبرك، وسنواصل العمل بجد ليكون مستوى تجربتك القادمة أفضل إن شاء الله.`, en:`We sincerely apologize for any inconvenience your experience may have caused, and we deeply value your feelings. We take your feedback very seriously and are working hard to pass it on to the restaurant to improve the service and provide the best at all times. Our aim is to offer you an exceptional experience that meets and exceeds your expectations in the future. We always strive to satisfy you, and we hope to regain your valuable trust in us. Thank you for your support and patience, and we will continue working hard so that your next experience will be at a better level, God willing.`},
  {ar:` نعتذر بصدق عن أي إزعاج قد تسببت به تجربتك معنا، ونقدر ملاحظاتك التي تساعدنا في التحسين. سيتم نقلها إلى المطعم للمساهمة في تقديم خدمة أفضل إن شاء الله. هدفنا هو أن نمنحك تجربة مميزة، ونسعى جاهدين لاستعادة ثقتك بنا. شكرًا لصبرك ودعمك، ونتطلع إلى خدمتك مجددًا بتجربة أفضل.`, en:`We sincerely apologize for any inconvenience your experience with us may have caused, and we truly value your feedback that helps us improve. It will be shared with the restaurant to contribute to providing better service, God willing. Our aim is to offer you a special experience that exceeds your expectations, and we strive to regain your trust. Thank you for your patience and support, and we look forward to serving you again with an even better experience.`},
  {ar:`نأسف لعدم تلبية توقعاتك هذه المرة، ونشكرك على إبلاغنا بملاحظاتك. نأخذ كل الملاحظات على محمل الجد ونعمل على تحسين خدماتنا باستمرار. نأمل أن تمنحنا فرصة أخرى لنقدم لك تجربة تفوق تطلعاتك في المستقبل. `, en:` We truly apologize if your experience did not meet your expectations. Customer satisfaction is at the heart of what we do, and we are constantly working on refining our service. We hope to have the opportunity to serve you again under better circumstances.`},
  {ar:`نحن آسفون لأن تجربتك لم تكن بالمستوى الذي نطمح إليه. نقدر ملاحظاتك ونعمل باستمرار على تطوير الخدمة. شكراً على تفهمك، ونتمنى أن نراك قريبًا بتجربة أكثر تميزًا`, en:`We are sorry that your experience was not at the level we strive for. We appreciate your feedback and continuously work on improving our service. Thank you for your understanding, and we hope to see you again soon with a more distinguished experience. `},
  {ar:` نعتذر من أعماق قلبنا عن أي إزعاج قد تسببت به تجربتك، ونحن نقدر تماماً مشاعرك. نحن نأخذ ملاحظاتك بكل جدية ونعمل جاهدين على نقلها إلى المطعم لتحسين الخدمة وتقديم الأفضل دائمًا. هدفنا هو أن نمنحك تجربة استثنائية تتناسب مع توقعاتك وتفوقها في المستقبل ان شاء الله.

`, en:`We sincerely apologize from the bottom of our hearts for any inconvenience your experience may have caused, and we truly value your feelings. We take your feedback very seriously and are working diligently to share it with the restaurant to improve the service and always deliver the best. Our goal is to provide you with an exceptional experience that meets and, God willing, exceeds your expectations in the future.

 `},
  {ar:`بنعتذر من حضرتك عميلنا العزيز نحن ملتزمون تماماً لإرضائك، ونتمنى أن نتمكن من استعادة ثقتك الغالية فينا. شكراً لك على دعمك وصبرك، وسنحرص على العمل بجد لتكون تجربتك القادمة أفضل ان شاء الله.

 `, en:`We sincerely apologize to you, our valued customer. We are fully committed to your satisfaction and hope to regain your precious trust in us. Thank you for your support and patience, and we promise to keep working hard to ensure that, God willing, your next experience will be much better.

 `},
  {ar:`اؤكد بأنني متفهم استياء حضرتك على التجربة الغير مرضية ونحن نقدم لك كامل الاعتذار، لقد تم أخذ ملاحظتك بعين الاعتبار، بتمنى تقبل اعتذارنا و ان لا يعكس أي انطباع سلبي. سنعمل على تحسين الخدمة بإذن الله عز وجل لك في المرات القادمة

 `, en:` We sincerely apologize for any inconvenience or disappointment you have encountered. We appreciate the time you took to share your feedback, as it helps us enhance our service. We hope to have the opportunity to serve you better in the future.

`},
  {ar:`نأسف لأن تجربتك لم تكن كما توقعت، فنحن نحرص على تقديم الأفضل دائمًا. ملاحظاتك ستساعدنا في التحسين، وسنسعى جاهدين لإرضائك. شكرًا لدعمك، ونتمنى أن تكون تجربتك القادمة أكثر راحة وسعادة.

 `, en:` We are sorry that your experience was not as you expected, as we always strive to provide the best. Your feedback will help us improve, and we will do our best to satisfy you. Thank you for your support, and we hope your next experience will be more comfortable and enjoyable.

`},
  {ar:`نعتذر عن أي إزعاج قد تسببت به هذه التجربة، فهدفنا هو تقديم خدمة ترضيك بالكامل. نحن نأخذ ملاحظاتك على محمل الجد ونعمل على تحسين الجودة باستمرار. شكراً لتفهمك، وسنبذل جهدنا لجعل تجربتك القادمة أكثر إرضاءً.

 `, en:` We are truly sorry for any disappointment you may have felt. Your experience is important to us, and we are implementing necessary improvements to prevent any recurrence of this issue. Thank you for your feedback and for allowing us the chance to enhance our service.

`},
  {ar:` نأسف لأي إزعاج قد واجهته، ونشكرك على ملاحظاتك القيمة. نحن نأخذ رضاك بجدية ونعمل باستمرار على تحسين مستوى الخدمة. نأمل أن تمنحنا فرصة أخرى لنقدم لك تجربة أفضل في المستقبل.

`, en:`We regret that your experience did not reflect the high standards we strive for. Please rest assured that we are working hard to prevent similar occurrences in the future. We greatly appreciate your understanding and the opportunity to make things better.

 `},
  {ar:`نعتذر عن أي تقصير حدث، ونتفهم أهمية تجربتك معنا. نحن نأخذ ملاحظاتك بعين الاعتبار لتحسين خدماتنا. شكراً لدعمك، ونسعى جاهدين لإرضائك مستقبلاً.

 `, en:` We apologize for any shortcomings and understand the importance of your experience with us. We take your feedback into account to improve our services. Thank you for your support, and we will strive to satisfy you in the future.

`},
  {ar:`نحن نأسف لأي تجربة غير مرضية، فهدفنا هو توفير خدمة ترقى إلى مستوى توقعاتك. نقدر ملاحظاتك وسنعمل على التحسين المستمر لإرضائك في المستقبل. شكراً لتفهمك، ونتمنى أن نراك قريبًا.

 `, en:` We apologize for any unsatisfactory experience, as our goal is to provide service that meets your expectations. We value your feedback and will work on continuous improvement to satisfy you in the future. Thank you for your understanding, and we hope to see you soon.

`},
  {ar:`نعتذر بصدق إذا لم تكن تجربتك بالمستوى الذي تأملته. نؤكد لك أن ملاحظاتك مهمة لنا، وسنعمل على تحسين الأمور لتكون تجربتك القادمة أفضل. نشكرك على دعمك ونتطلع إلى خدمتك مرة أخرى قريبًا.

 `, en:`We sincerely apologize if your experience was not at the level you expected. Please know that your feedback is important to us, and we will work on improving things to make your next experience better. Thank you for your support, and we look forward to serving you again soon.

 `},
  {ar:`نأسف لأي تجربة غير مرضية مررت بها. نحن ملتزمون بتقديم أفضل خدمة ممكنة وسنعمل على تحسينها بناءً على ملاحظاتك. نشكرك على ثقتك بنا ونتمنى أن نراك قريبًا بتجربة أكثر راحة وسعادة.

 `, en:` We deeply regret that we were unable to provide the seamless experience that you deserve. Please know that we are actively working to resolve any issues and ensure that future experiences meet and exceed your expectations. We truly appreciate your patience.

`},
  {ar:` نحن آسفون لأن تجربتك لم تكن بالمستوى الذي نطمح إليه. شكرًا لملاحظاتك، وهي محل اهتمامنا لتحسين جودة الخدمات. نقدر تفهمك ونتمنى أن تمنحنا فرصة لنقدم لك تجربة أفضل مستقبلاً.

`, en:` We understand that your time and satisfaction are valuable, and we apologize for any inconvenience you may have encountered. Please know that we take all feedback seriously and are continuously working to enhance our service to better meet your needs.

`},
  {ar:`نعتذر عن أي خلل قد واجهته خلال تجربتك، ونشكرك على إبلاغنا بذلك. رضاك هو أولويتنا ونسعى جاهدين لتحسين الخدمة مستقبلاً. نتمنى أن تمنحنا فرصة أخرى لنثبت لك مدى التزامنا برضاك.

 `, en:` We apologize for any issues you encountered during your experience, and we thank you for bringing them to our attention. Your satisfaction is our priority, and we strive to improve our service in the future. We hope you give us another opportunity to show you our commitment to your satisfaction.

`},
  {ar:` نأسف لأي تقصير قد حدث، فهدفنا هو توفير تجربة مثالية لعملائنا. نحن نعمل بجد لتحسين الخدمة بناءً على ملاحظاتك. شكراً لصبرك، ونتمنى أن تكون تجربتك القادمة أكثر راحة ان شاء الله.

`, en:`We apologize for any shortcomings that may have occurred, as our goal is to provide an ideal experience for our customers. We are working hard to improve the service based on your feedback. Thank you for your patience, and we hope your next experience will be more comfortable.

 `},
  {ar:`نعتذر بصدق عن أي إزعاج حدث خلال طلبك، فنحن نسعى دائمًا لتقديم الأفضل. ملاحظاتك محل اهتمامنا، وسنسعى لتحسين التجربة لإرضائك مستقبلاً. شكراً لدعمك، ونتمنى أن نراك قريبًا.

 `, en:` We sincerely apologize for any inconvenience during your order, as we always strive to provide the best. Your feedback is important to us, and we will work to improve the experience to satisfy you in the future. Thank you for your support, and we hope to see you soon.

`},
  {ar:`نأسف لأن تجربتك لم تكن كما توقعت، وسنعمل على تحسين خدماتنا لتفادي تكرار ذلك إن شاء الله. شكراً لوقتك وثقتك بنا، وسنسعى جاهدين لتقديم تجربة مرضية لك مستقبلاً.

 `, en:`We are sorry that your experience was not as you expected, and we will work on improving our services to prevent this from happening again, God willing. Thank you for your time and trust in us, and we will strive to provide you with a satisfactory experience in the future.

 `},
  {ar:`نعتذر عن أي تجربة غير مرضية قد مررت بها، ونعمل على تحسين الخدمة بناءً على ملاحظاتك. نشكرك على تفهمك، و سنحرص على أن تكون تجربتك القادمة أكثر راحة.

 `, en:`  We’re truly sorry for any inconvenience caused. We understand this wasn’t ideal and are committed to improving your experience next time. Thank you for trusting us.

`},
  {ar:`نعتذر عن أي تقصير قد واجهته، وسنعمل على تحسين خدماتنا لإرضائك قدر الإمكان. شكراً لك على ملاحظاتك القيمة، ونتمنى أن تمنحنا فرصة أخرى لخدمتك بشكل أفضل.

 `, en:` We apologize for any shortcomings you may have experienced, and we will work on improving our services to satisfy you as much as possible. Thank you for your valuable feedback, and we hope you give us another opportunity to serve you better.

`},
  {ar:`نأسف لأي إزعاج قد سبّبته تجربتك معنا، وسنسعى بتحسين الخدمة لتكون على مستوى توقعاتك. نشكر لك تفهمك، ونتمنى أن نراك مجددًا في تجربة أكثر راحة وسعادة.

 `, en:` We are truly sorry that your recent order did not go as expected. Your trust is important to us, and we are dedicated to improving our service based on your valuable feedback. Please accept our apologies, and we hope to provide you with a much smoother experience in the future.

`},
  {ar:` نحن نأسف لأي قصور قد حدث أثناء تجربتك، وندرك تمامًا مدى أهمية تقديم خدمة مميزة تلبي تطلعاتك. رضاك هو حجر الأساس الذي نبني عليه خدماتنا، ولذلك فإننا نأخذ جميع الملاحظات على محمل الجد ونعمل جاهدين على تحسين التجربة لتقديم مستوى عالٍ من الجودة مستقبلاً. نشكر لك تفهمك وثقتك بنا، ونسعى باستمرار لجعل كل تجربة لك معنا أفضل من السابقة.

`, en:` We are sorry for any shortcomings you may have experienced, and we fully recognize the importance of providing outstanding service that meets your expectations. Your satisfaction is the foundation upon which we build our services, which is why we take all feedback seriously and work hard to improve the experience to deliver a high level of quality in the future. Thank you for your understanding and trust, and we continuously strive to make each experience with us better than the last.

`},
  {ar:`نأسف بشدة لأي تجربة غير مرضية قد واجهتها، ونتفهم تمامًا مدى الإحباط الذي قد تشعر به عند عدم الحصول على الخدمة بالمستوى المتوقع. نحن نعمل بجد لتحسين الجودة والاستجابة السريعة للملاحظات الخاصة بعملائنا، وسنسعى جاهدين لجعل تجربتك القادمة أكثر سلاسة وراحة. نشكرك على تفهمك، ونتطلع إلى خدمتك قريبًا بطريقة تليق بثقتك بنا.

 `, en:` We deeply regret any unsatisfactory experience you may have had, and we fully understand the frustration of not receiving service at the expected level. We are working hard to improve quality and respond promptly to our customers’ feedback, and we will strive to make your next experience smoother and more comfortable. Thank you for your understanding, and we look forward to serving you soon in a manner worthy of your trust.

`},
  {ar:`نتفهم تمامًا أنك كنت تتوقع تجربة أفضل، ونحن نأسف لأننا لم نرتقِ إلى مستوى تطلعاتك هذه المرة. نقدّر صبرك وملاحظاتك التي تساعدنا على التطوير، ونعمل بلا توقف لتحسين الخدمة لتكون أكثر سلاسة وجودة إن شاء الله. نأمل أن تمنحنا فرصة أخرى لنثبت لك أننا نستحق ثقتك، ونتطلع لأن تكون تجربتك القادمة معنا أكثر راحة ورضا.

 `, en:` We fully understand that you expected a better experience, and we are sorry that we did not meet your expectations this time. We appreciate your patience and feedback, which help us improve, and we continuously work to enhance the service to make it smoother and of higher quality, God willing. We hope you give us another opportunity to show that we deserve your trust, and we look forward to your next experience with us being more comfortable and satisfying.

`},
];

const shortApology = [
 {ar:`نعتذر يا الغالي عن التجربة اللي ما كانت بالمستوى، وراح نحرص تكون القادمة أفضل بإذن الله.`, en:`We’re sorry your experience wasn’t great, we’ll make sure the next one is better insha’Allah.`},
{ar:`آسفين إذا واجهت أي إزعاج، ملاحظتك تهمنا وراح نحسن الخدمة للأفضل.`, en:`Sorry for the inconvenience — your feedback matters and we’ll improve our service.`},
{ar:`نأسف إن التجربة ما كانت مثل توقعاتك، وراح نعمل على تحسينها مستقبلاً.`, en:`We’re sorry it didn’t meet your expectations, we’ll make it better next time.`},
{ar:`نعتذر عن القصور، ونتفهم ملاحظاتك وراح نطور الخدمة قريب إن شاء الله.`, en:`We apologize for the shortfall and we’ll work on improving soon, God willing.`},
{ar:`نأسف لو سبّبنا لك أي إزعاج، هدفنا دايمًا رضاك وتقديم الأفضل.`, en:`We’re sorry for any inconvenience — our goal is always your satisfaction.`},
{ar:`نعتذر منك، بنحرص نكسب رضاك ونستعيد ثقتك فينا.`, en:`Our apologies, we’ll work to regain your trust and satisfaction.`},
{ar:`نأسف على التجربة، وراح نراجع الملاحظات لضمان تحسين الخدمة.`, en:`Sorry about your experience — we’ll review your feedback to improve our service.`},
{ar:`نعتذر عن اللي صار، وراح نسعى تكون تجربتك القادمة أسهل وأفضل.`, en:`We’re sorry about what happened — we’ll make your next experience smoother.`},
{ar:`نأسف لأي تقصير، بنشتغل دايم على رفع الجودة وتطوير الخدمة.`, en:`Apologies for the shortfall — we’re constantly improving our quality.`},
{ar:`آسفين على اللي صار، وشاكرين ملاحظاتك اللي تساعدنا نتحسن.`, en:`Sorry about what happened, your feedback helps us improve.`},
{ar:`نعتذر على أي خلل، وراح نعمل على تحسين تجربتك القادمة بإذن الله.`, en:`We apologize for any issue and we’ll improve your next experience insha’Allah.`},
{ar:`نأسف على التجربة الغير مرضية، وراح نعمل على تطوير الخدمة بشكل مستمر.`, en:`Sorry for the unsatisfactory experience — we’ll keep improving our service.`},
{ar:`نعتذر إذا ما كانت التجربة بالمستوى، وراح نحسن الأمور لرضاك.`, en:`Sorry if it wasn’t as expected — we’ll make things right for you.`},
{ar:`نأسف على أي إزعاج، وراح نتابع الملاحظات لضمان الأفضل.`, en:`Apologies for any inconvenience — we’ll follow up to ensure better service.`},
{ar:`نعتذر عن التقصير، وملاحظتك بتفيدنا في تحسين الخدمة أكثر.`, en:`Sorry for any shortcomings — your feedback helps us get better.`},
{ar:`آسفين على التجربة، وشكرًا لتفهمك وثقتك.`, en:`Sorry about the experience, and thank you for your understanding and trust.`},
{ar:`نعتذر إذا واجهت مشكلة، ونعمل نتأكد إنها ما تتكرر.`, en:`We’re sorry for the issue and will make sure it doesn’t happen again.`},
{ar:`نأسف لأي قصور، وبنحرص تكون المرات الجاية مرضية لك أكثر.`, en:`Apologies for any shortfall — we’ll make sure next time is better.`},
{ar:`نعتذر عن الإزعاج، وملاحظتك محل اهتمام الفريق.`, en:`Sorry for the inconvenience — your feedback is being reviewed by the team.`},
{ar:`نأسف إذا التجربة ما كانت بالمستوى، ونتمنى فرصة نعوضك فيها.`, en:`We’re sorry it wasn’t up to standards — we hope to make it up to you.`},
{ar:`نعتذر عن أي تقصير، وراح نطور الأداء بناءً على ملاحظتك.`, en:`We apologize for any shortfall — we’ll improve our performance accordingly.`},
{ar:`نأسف لو الخدمة ما كانت ترضيك، وراح نحرص تكون الجاية أريح وأسرع.`, en:`Sorry if the service wasn’t satisfying — we’ll make it smoother next time.`},
{ar:`نعتذر على التجربة الغير مرضية، وهدفنا نخدمك بشكل أفضل الجاية.`, en:`Sorry for the disappointing experience — our goal is to serve you better next time.`},
{ar:`نأسف لأي خلل صار، ونعمل على تحسين التجربة القادمة.`, en:`We’re sorry for any issue, and we’ll enhance your next experience.`},
{ar:`نعتذر على اللي حصل، وثقتك تهمنا ونسعى نحافظ عليها.`, en:`Apologies for what happened — your trust matters and we’ll keep it.`},
{ar:`نأسف إن التجربة ما كانت مثالية، ووعدنا لك إن الجاية تكون أفضل بإذن الله.`, en:`Sorry the experience wasn’t perfect — we promise the next one will be better, God willing.`}
];

const hold = [
  // 🔟 الأصلية بدون أي تعديل
  { ar: `أحتاج إلى دقيقة إضافية لإنهاء العمل المطلوب، وأقدّر تفهمك.`, en: `I need an extra minute to complete the required task, and I appreciate your understanding.` },
  { ar: `سأستغرق دقيقة أخرى للتحقق من التفاصيل، شكرًا على صبرك.`, en: `I will take another minute to verify the details. Thank you for your patience.` },
  { ar: `أحتاج إلى دقيقة إضافية الآن، لكن قد أضطر لطلب وقت إضافي حسب المستجدات.`, en: `I need an additional minute now, but I might have to request more time depending on the updates.` },
  { ar: `ما زال لدي بعض الأمور التي تحتاج إلى دقيقة أخرى للمراجعة، شاكر لتفهمك.`, en: `There are still some matters that require another minute for review. I appreciate your understanding.` },
  { ar: `أحتاج إلى دقيقة أخرى في هذه المرحلة، وإذا احتجت وقتًا إضافيًا سأعلمك.`, en: `I need one more minute at this stage, and I will let you know if I require additional time.` },
  { ar: `سأستغرق دقيقة أخرى في الوقت الحالي، وإذا احتجت إلى وقت إضافي سأخبرك.`, en: `I will take another minute for now, and I’ll inform you if I need more time.` },
  { ar: `الرجاء الانتظار دقيقة أخرى حتى أتمكن من إنهاء العمل المطلوب بشكل دقيق، شكرًا لتفهمك.`, en: `Please wait one more minute so I can complete the task accurately. Thank you for your understanding.` },
  { ar: `أحتاج إلى دقيقة إضافية الآن، وإذا لم يكتمل الأمر فقد أطلب وقتًا إضافيًا لاحقًا.`, en: `I need an extra minute now, and if the matter is not completed, I may request additional time later.` },
  { ar: `أحتاج إلى دقيقة أخرى لاستكمال العمل على أكمل وجه، واشكرك على تعاونك.`, en: `I need another minute to complete the task properly, and I appreciate your cooperation.` },

  // ➕ إضافات جديدة بنفس الأسلوب
  { ar: `ممكن دقيقة إضافية لو سمحت حتى أتأكد من التفاصيل النهائية.`, en: `May I please have another minute to double-check the final details?` },
  { ar: `أحتاج دقيقة واحدة فقط لأراجع آخر التحديثات قبل ما أرجع لك.`, en: `I just need one minute to review the latest updates before I get back to you.` },
  { ar: `ممكن دقيقة واحدة بس أتحقق من النظام وأوافيك بالنتيجة.`, en: `Could you please give me a minute to check the system and provide you the result?` },
  { ar: `أحتاج دقيقة إضافية لأتأكد من جميع النقاط المطلوبة بدقة.`, en: `I need an extra minute to make sure all points are reviewed accurately.` },
  { ar: `أشيّك على الحالة الآن، وراح أرجع لك بعد دقيقة بالتأكيد النهائي.`, en: `I’m checking the case now and will get back to you within a minute with the final confirmation.` },
  { ar: `لو سمحت، أحتاج دقيقة إضافية للتأكد من الإجراءات الجارية.`, en: `Please, I need one more minute to confirm the ongoing process.` },
  { ar: `أتحقق من الملاحظات الآن وراح أبلغك خلال دقيقة بالنتيجة.`, en: `I’m reviewing the notes now and will update you within a minute with the result.` },
  { ar: `ممكن دقيقة فقط للتأكد من كل شيء قبل أبلغك بالتفاصيل النهائية.`, en: `Just one minute please to make sure everything is clear before I share the final details.` }
];

let used = {longApology:[], shortApology:[], hold:[]};

function generate(type){
  let list = eval(type);
  let remain = list.filter((_,i)=>!used[type].includes(i));
  if(remain.length===0){
    document.getElementById('popup').classList.remove('hidden');
    document.getElementById('popupMsg').textContent = `🎉 تم عرض كل ${type==='hold'?'الهولد':'الاعتذارات'}، يمكنك البدء من جديد.`;
    return;
  }
  let randomIndex = Math.floor(Math.random()*remain.length);
  let idx = list.indexOf(remain[randomIndex]);
  used[type].push(idx);
  if(type==='hold'){
    showText('holdAr','holdEn',list[idx]);
  }else if(type==='shortApology'){
    showText('shortAr','shortEn',list[idx]);
  }else{
    showText('longAr','longEn',list[idx]);
  }
}

function showText(idAr,idEn,obj){
  document.getElementById(idAr).textContent=obj.ar;
  document.getElementById(idEn).textContent=obj.en;
}

function copyText(id){
  const el=document.getElementById(id);
  navigator.clipboard.writeText(el.textContent);
  el.style.background="#d8ecff";
  setTimeout(()=>el.style.background="#f3f7ff",400);
}

function resetLists(){
  used={longApology:[], shortApology:[], hold:[]};
  document.getElementById('popup').classList.add('hidden');
}
function calc(rate){
  const input = document.getElementById('calcInput').value;
  const result = document.getElementById('calcResult');
  if(!input || isNaN(input)){
    result.textContent = 'الرجاء إدخال رقم صالح';
    return;
  }
  const total = (input * rate).toFixed(2);
  result.textContent = `النتيجة: ${total}`;
}
  const el = (id) => document.getElementById(id);
const CALL_LINE = "Call merchant ,call results ; needed Restaurant admitted the mistake";
const COMP_LINE = "no Compensation";

function isNumericOrEmpty(v) {
  if (!v) return true;
  return /^-?\d+(\.\d+)?$/.test(v.trim());
}

function buildTemplate() {
  const selectedRC = getSelectedRC();
const riskLabelLine = `Case Solution Risk Label: ${selectedRC || '—'}`;
  const evidence   = el('evidence').value;
  const receipt    = el('receipt').value;
  const callType   = el('callType').value;
  const callResult = (el('callResult').value || '').trim();
  let refund       = (el('refund').value || '').trim();
  let compensation = (el('compensation').value || '').trim();

 if (!refund) {
  refund = "no refund";
}
  if (!isNumericOrEmpty(compensation)) {
    alert('حقل Compensation يجب أن يحتوي رقمًا فقط أو يترك فارغًا.');
    el('compensation').focus();
    return;
  }

  if (!refund) refund = "no refund";
  if (!compensation) compensation = "no compensation";

  // بناء نص الكول لاين
  // بناء نص الكول لاين
let callLine = "";
let normalizedCall = callType.toLowerCase().replace(/\s+/g, "");

if (normalizedCall === "noneed") {
  callLine = "Call merchant/Rider , Call result : No need";
} else if (normalizedCall === "merchant") {
  if (!callResult) {
    alert("اكتب نتيجة المكالمة مع التاجر.");
    return;
  }
  callLine = `Call merchant , Call result : ${callResult}`;
} else if (normalizedCall === "rider") {
  if (!callResult) {
    alert("اكتب نتيجة المكالمة مع السائق.");
    return;
  }
  callLine = `Call rider , Call result : ${callResult}`;
} else {
  callLine = "Call merchant/Rider , Call result : No need";
}

  const lines = [
    `Call line: ${callLine}`,
    `Case Solution Risk Label: (${risk})RC`,
    `Evidence: ${evidence}`,
    `Receipt: ${receipt}`,
    `Refund: (${refund}) `,
    `Compensation: (${compensation}) `
  ];

  el('output').value = lines.join("\n");
}

function clearAll() {
  el('riskLabel').value = '0';
  el('evidence').value = 'Clear';
  el('receipt').value = 'yes';
  el('refund').value = '';
  el('output').value = '';
}

el('output').addEventListener('click', () => {
  el('output').select();
  document.execCommand('copy');
  alert("✔ تم النسخ بنجاح");
});

el('build').addEventListener('click', buildTemplate);
el('clear').addEventListener('click', clearAll);
function toggleCallInput(){
  const callType = el('callType').value;
  const box = document.getElementById('callResultBox');
  if(callType === "merchant" || callType === "rider"){
    box.style.display = "grid";
  } else {
    box.style.display = "none";
    el('callResult').value = "";
  }
 function toggleCallInput() {
  const callType = el('callType').value;
  const box = document.getElementById('callResultBox');
  if (callType === "merchant" || callType === "rider") {
    box.style.display = "grid";
  } else {
    box.style.display = "none";
    el('callResult').value = "";
  }
}

function toggleRCOptions() {
  const val = document.getElementById('riskLabel').value;
  const box = document.getElementById('rcOptions');

  if (val === 'Red' || val === 'Purple') {
    box.style.display = 'block';

    // ✅ يحدد أول خيار (0RC) تلقائيًا
    const firstRC = document.querySelector('input[name="subRC"][value="0RC"]');
    if (firstRC) firstRC.checked = true;

  } else {
    box.style.display = 'none';
    document.querySelectorAll('input[name="subRC"]').forEach(i => (i.checked = false));
  }
}

function getSelectedRC() {
  const main = document.getElementById('riskLabel').value;
  if (main === 'Red' || main === 'Purple') {
    const sub = document.querySelector('input[name="subRC"]:checked');
    return sub ? `${sub.value} (${main})` : `${main}`;
  }
  return main || '';
}

function buildTemplate() {
  const selectedRC = getSelectedRC();
  const riskLabelLine = `Case Solution Risk Label: ${selectedRC || '—'}`;
  const evidence   = el('evidence').value;
  const receipt    = el('receipt').value;
  const callType   = el('callType').value;
  const callResult = (el('callResult').value || '').trim();
  const refund     = el('refund').value;
  let compensation = (el('compensation').value || '').trim();

  if (!compensation) compensation = "no compensation";

  let callLine = "";
  if (callType === "noneed") {
    callLine = "Call merchant/Rider , Call result : No need";
  } else if (callType === "merchant") {
    if (!callResult) {
      alert("اكتب نتيجة المكالمة مع التاجر.");
      return;
    }
    callLine = `Call merchant , Call result : ${callResult}`;
  } else if (callType === "rider") {
    if (!callResult) {
      alert("اكتب نتيجة المكالمة مع السائق.");
      return;
    }
    callLine = `Call rider , Call result : ${callResult}`;
  } else {
    alert("اختَر نوع المكالمة أولاً.");
    return;
  }

  const lines = [
    ` ${callLine}`,
    riskLabelLine,
    `Evidence: ${evidence}`,
    `Receipt: ${receipt}`,
    `Refund: (${refund})`,
    `Compensation: (${compensation}) compensation`
  ];

  el('output').value = lines.join("\n");
}

el('build').addEventListener('click', buildTemplate);
el('clear').addEventListener('click', () => {
  el('riskLabel').value = '0RC';
  el('evidence').value = 'No need';
  el('receipt').value = 'No need';
  el('refund').value = 'No refund';
  el('compensation').value = '';
  el('output').value = '';
  toggleRCOptions(); // يخفي الحقل عند المسح
});
}
// ✅ لإظهار حقل RC فقط عند اختيار Red أو Purple
function toggleRCOptions() {
  const val = document.getElementById('riskLabel').value;
  const box = document.getElementById('rcOptions');
  if (val === 'Red' || val === 'Purple') {
    box.style.display = 'grid';
  } else {
    box.style.display = 'none';
    document.querySelectorAll('input[name="subRC"]').forEach(i => i.checked = false);
  }
}

// ✅ لبناء النص النهائي في التيمبليت
function getSelectedRC() {
  const main = document.getElementById('riskLabel').value;
  if (main === 'Red' || main === 'Purple') {
    const sub = document.querySelector('input[name="subRC"]:checked');
    return sub ? `${sub.value} (${main})` : `${main}`;
  }
  return main || '';
}
window.addEventListener("DOMContentLoaded", () => {
  document.getElementById("callType").value = "noneed";
  toggleCallInput();
});
</script>
<script>
// ✅ إشعار "تم النسخ بنجاح" لكل الموقع + إصلاح النسخ في كل الأقسام
window.addEventListener("load", () => {
  // إنشاء الإشعار
  let notice = document.createElement("div");
  notice.id = "copyNotice";
  notice.textContent = "✔ تم النسخ بنجاح";
  Object.assign(notice.style, {
    position: "fixed",
    top: "45px",
    right: "20px",
    background: "#e8fff3",
    color: "#00b36b",
    padding: "8px 16px",
    borderRadius: "8px",
    boxShadow: "0 3px 10px rgba(0,0,0,0.1)",
    fontSize: "13px",
    fontFamily: "Cairo, sans-serif",
    opacity: "0",
    zIndex: "999999",
    transition: "opacity 0.4s ease, transform 0.4s ease",
    transform: "translateY(-10px)"
  });
  document.body.appendChild(notice);

  // دالة عرض الإشعار
  window.showCopiedNotice = function() {
    notice.style.opacity = "1";
    notice.style.transform = "translateY(0)";
    clearTimeout(window.noticeTimeout);
    window.noticeTimeout = setTimeout(() => {
      notice.style.opacity = "0";
      notice.style.transform = "translateY(-10px)";
    }, 1000); // ← مدة الظهور = ثانية واحدة
  };

  // ✅ نربط الحدث لجميع العناصر القابلة للنسخ
  function enableCopying() {
    document.querySelectorAll(".msg, .msgBox, textarea#output, .fixed-msg").forEach(el => {
      el.onclick = () => {
        const text = el.value || el.textContent.trim();
        if (!text) return;
        navigator.clipboard.writeText(text);
        showCopiedNotice();
      };
    });
  }

  // نفعّل النسخ أول مرة
  enableCopying();

  // 🎯 لو تمت إضافة عناصر جديدة (مثل عند إنشاء سكربت جديد)
  const observer = new MutationObserver(enableCopying);
  observer.observe(document.body, { childList: true, subtree: true });

  // ✅ لو أي نص انسخ بالطريقة العادية (Ctrl+C)
  document.addEventListener("copy", showCopiedNotice);
});
</script>
 <!-- 🟦 نافذة التحديث (Popup) -->
<!-- 🩵 نافذة التحديثات الجميلة -->
<div id="updatePopup" style="
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.45);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999999;
  font-family: 'Cairo', sans-serif;
">
  <div id="updateBox" style="
    position: relative;
    background: rgba(255,255,255,0.25);
    backdrop-filter: blur(15px) saturate(160%);
    -webkit-backdrop-filter: blur(15px) saturate(160%);
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 16px;
    box-shadow: 0 8px 25px rgba(0,0,0,.25);
    padding: 30px;
    text-align: center;
    width: 420px;
    max-width: 90%;
    animation: fadeIn .5s ease;
  ">
    <h2 style="color:#285eff;margin-bottom:12px;">اللهم هون على اهلنا في غزه والسودان</h2>
    <p style="color:#1a1a1a;font-size:15px;">اقرأ الملاحظات ثم اضغط على تمّ القراءة 👇</p>

    <ul style="text-align:right;color:#333;font-size:20px;line-height:2;margin:15px 0;">
      <li>ضفنا خانه السكربتات</li>
      <li>صار الموقع اسهل صلحت بعض الاخطاء</li>
      <li>  ضروري لما ارسلك خانه التحديث تحدث ✅</li>
    </ul>

    <button id="readBtn" style="
      background:#285eff;
      color:#fff;
      border:none;
      padding:10px 25px;
      border-radius:10px;
      cursor:pointer;
      font-size:15px;
      font-weight:bold;
      transition:all .3s ease;
      animation: shake 2s infinite ease-in-out;
    ">📖 تمّت القراءة</button>

    <br><br>

    <button id="skipBtn" style="
      background:#fff;
      color:#285eff;
      border:2px solid #285eff;
      padding:8px 20px;
      border-radius:10px;
      cursor:pointer;
      font-size:14px;
      position: relative;
      transition: transform 0.25s ease; /* أسرع */
      margin-top:10px;
    ">تخطي ✨</button>

    <p id="funnyMsg" style="
      display:none;
      color:#ff4747;
      font-size:13px;
      font-weight:bold;
      margin-top:10px;
    ">😂 مش قادر تكبس؟ اقرأ أول!</p>
  </div>
</div>

<script>
const skipBtn = document.getElementById("skipBtn");
const readBtn = document.getElementById("readBtn");
const funnyMsg = document.getElementById("funnyMsg");
let hasRead = false;
let currentDirection = 1; // 1 = يمين، -1 = يسار

// ✨ اهتزاز لطيف لزر القراءة
readBtn.animate([
  { transform: "translate(0,0)" },
  { transform: "translate(2px,0)" },
  { transform: "translate(-2px,0)" },
  { transform: "translate(2px,0)" },
  { transform: "translate(0,0)" }
], { duration: 800, iterations: Infinity });

// ✅ يثبّت الزر بعد القراءة
readBtn.onclick = () => {
  hasRead = true;
  readBtn.style.background = "#22c55e";
  readBtn.textContent = "✅ تم التأكيد";
  funnyMsg.style.display = "none";
  skipBtn.style.transform = "translateX(0)";
};

// ⚡ الزر يهرب بسرعة عند الاقتراب
skipBtn.onmouseenter = () => {
  if (!hasRead) {
    funnyMsg.style.display = "block";

    // يبدّل الاتجاه كل مرة
    currentDirection *= -1;

    const distance = 120 * currentDirection; // يتحرك يمين أو يسار
    skipBtn.style.transform = `translateX(${distance}px)`;
  }
};

// ✅ يسمح بالتخطي فعلاً بعد القراءة
skipBtn.onclick = () => {
  if (hasRead) closePopup();
};

// 🔻 إغلاق النافذة بلطف
function closePopup() {
  const popup = document.getElementById("updatePopup");
  popup.style.opacity = 0;
  popup.style.pointerEvents = "none";
  setTimeout(() => popup.remove(), 400);
}
</script>

<style>
@keyframes fadeIn {
  from {opacity: 0; transform: scale(0.95);}
  to {opacity: 1; transform: scale(1);}
}
@keyframes shake {
  0%, 100% { transform: translate(0, 0); }
  25% { transform: translate(2px, 0); }
  50% { transform: translate(-2px, 0); }
  75% { transform: translate(2px, 0); }
}
</style>
<script>
function closePopup() {
  const popup = document.getElementById("updatePopup");
  if (!popup) return;
  
  // تعطيل الضغط بعد الكبس
  popup.style.pointerEvents = "none";
  popup.style.opacity = "0";

  // إزالته بعد نصف ثانية
  setTimeout(() => {
    if (popup.parentNode) popup.remove();
  }, 500);
}
</script>

<style>
@keyframes fadeIn {
  from {opacity: 0; transform: scale(0.95);}
  to {opacity: 1; transform: scale(1);}
}
</style>
<script>
document.addEventListener("click", function(e) {
  const msg = e.target.closest(".msg");
  if (!msg) return;

  // نقرأ النص الأصلي
  let text = msg.textContent.trim();

  // نجيب اسم المطعم من الحقل
  const restInput = document.getElementById("restaurantName");
  const restName = restInput ? restInput.value.trim() : "";

  // 🔹 لو فيه اسم مطعم نستبدله داخل أول قوسين فقط
  if (restName && /\(\s*[^\)]*\s*\)/.test(text)) {
    text = text.replace(/\(\s*[^\)]*\s*\)/, "(" + restName + ")");
  }

  // نسخ النص إلى الكليب بورد
  navigator.clipboard.writeText(text);

  // إظهار إشعار بسيط
  let note = document.getElementById("copyNoteFinal");
  if (!note) {
    note = document.createElement("div");
    note.id = "copyNoteFinal";
    note.textContent = "✅ تم النسخ";
    Object.assign(note.style, {
      position: "fixed",
      bottom: "20px",
      right: "20px",
      background: "#285eff",
      color: "#fff",
      padding: "8px 14px",
      borderRadius: "8px",
      fontFamily: "Cairo, sans-serif",
      fontSize: "14px",
      opacity: "0",
      transition: "opacity .3s ease",
      zIndex: "99999"
    });
    document.body.appendChild(note);
  }

  note.style.opacity = "1";
  setTimeout(() => (note.style.opacity = "0"), 1000);
});
</script>
<!-- 🐍 لعبة الحية المتطورة -->
<script>
let snakeContainer, canvas, ctx, snake, direction, nextDirection, food, score, gameLoop, speed = 100, grid = 10;
let isPaused = false; // ⏸️ حالة الإيقاف

// 🎮 المفاتيح
document.addEventListener("keydown", (e) => {
  const key = e.key.toLowerCase();

  // 🔹 Ctrl + M → إظهار أو إخفاء اللعبة
  if ((e.ctrlKey || e.metaKey) && key === "m") {
    e.preventDefault();
    toggleSnake();
  }

  // 🔸 Shift → إيقاف أو استئناف
  if (key === "shift") {
    e.preventDefault();
    togglePause();
  }
});

function toggleSnake() {
  // ✅ إذا مفتوحة: نخفيها ونوقفها
  if (snakeContainer && snakeContainer.style.display === "block") {
    pauseSnake(); // يوقف
    snakeContainer.style.display = "none";
  } 
  // ✅ إذا مخفية: نرجعها، لكن تبقى موقوفة
  else {
    if (!snakeContainer) initSnake();
    else {
      snakeContainer.style.display = "block";
      applyPausedStyle(); // ترجع بنفس شكل الإيقاف
    }
  }
}

function initSnake() {
  if (!snakeContainer) {
    snakeContainer = document.createElement("div");
    Object.assign(snakeContainer.style, {
      position: "fixed",
      bottom: "20px",
      left: "20px",
      background: "rgba(15,15,25,0.95)",
      border: "3px solid #b066ff",
      borderRadius: "16px",
      padding: "12px",
      boxShadow: "0 0 25px rgba(176,102,255,0.6)",
      zIndex: "99999",
      transition: "all 0.3s ease"
    });
    snakeContainer.innerHTML = `
      <canvas id="snakeCanvas" width="320" height="320" style="border-radius:12px; background:#000;"></canvas>
      <div style="text-align:center; color:#fff; font-family:'Cairo',sans-serif; margin-top:8px;">
        <span id="snakeScore">النقاط: 0</span>
        <button id="restartSnake" style="background:#9b5cff;color:#fff;border:none;padding:6px 12px;border-radius:8px;margin-left:8px;cursor:pointer;">🔄 إعادة</button>
        <button id="pauseSnake" style="background:#ff9900;color:#fff;border:none;padding:6px 12px;border-radius:8px;margin-left:8px;cursor:pointer;">⏸️ إيقاف</button>
      </div>
    `;
    document.body.appendChild(snakeContainer);

    document.getElementById("restartSnake").addEventListener("click", restartGame);
    document.getElementById("pauseSnake").addEventListener("click", togglePause);
  }

  canvas = document.getElementById("snakeCanvas");
  ctx = canvas.getContext("2d");

  restartGame();
  document.addEventListener("keydown", handleDirection);
}

function restartGame() {
  snake = [
    { x: 15 * grid, y: 15 * grid },
    { x: 14 * grid, y: 15 * grid },
    { x: 13 * grid, y: 15 * grid },
  ];
  direction = "RIGHT";
  nextDirection = "RIGHT";
  food = randomFood();
  score = 0;
  document.getElementById("snakeScore").textContent = "النقاط: 0";
  clearInterval(gameLoop);
  gameLoop = setInterval(drawGame, speed);
  isPaused = false;
  resetPausedStyle();
}

function handleDirection(e) {
  const key = e.key.toLowerCase();
  if (key === "arrowup" && direction !== "DOWN") nextDirection = "UP";
  else if (key === "arrowdown" && direction !== "UP") nextDirection = "DOWN";
  else if (key === "arrowleft" && direction !== "RIGHT") nextDirection = "LEFT";
  else if (key === "arrowright" && direction !== "LEFT") nextDirection = "RIGHT";
}

function drawGame() {
  if (isPaused) return; // 🚫 لا تتحرك أثناء الإيقاف

  direction = nextDirection;
  ctx.fillStyle = "#000";
  ctx.fillRect(0, 0, 320, 320);

  // 🍎 رسم الطعام
  const foodGradient = ctx.createRadialGradient(food.x + 5, food.y + 5, 2, food.x + 5, food.y + 5, 8);
  foodGradient.addColorStop(0, "#ffaaaa");
  foodGradient.addColorStop(1, "#ff3333");
  ctx.fillStyle = foodGradient;
  ctx.shadowBlur = 15;
  ctx.shadowColor = "#ff0000";
  ctx.beginPath();
  ctx.arc(food.x + 5, food.y + 5, 6, 0, Math.PI * 2);
  ctx.fill();
  ctx.shadowBlur = 0;

  // 🐍 حركة الرأس
  const head = { ...snake[0] };
  if (direction === "UP") head.y -= grid;
  if (direction === "DOWN") head.y += grid;
  if (direction === "LEFT") head.x -= grid;
  if (direction === "RIGHT") head.x += grid;

  // 💀 التحقق من الخسارة
  if (head.x < 0 || head.y < 0 || head.x >= 320 || head.y >= 320 || snake.some(s => s.x === head.x && s.y === head.y)) {
    clearInterval(gameLoop);
    ctx.fillStyle = "#ff3333";
    ctx.font = "22px Cairo";
    ctx.textAlign = "center";
    ctx.fillText("💀 خسرت! النقاط: " + score, 160, 160);
    return;
  }

  // 🧩 أكل الطعام
  snake.unshift(head);
  if (head.x === food.x && head.y === food.y) {
    score++;
    document.getElementById("snakeScore").textContent = "النقاط: " + score;
    food = randomFood();
  } else {
    snake.pop();
  }

  // 🟢 الحية المتوهجة بخط متصل ناعم
  ctx.lineWidth = 16;
  ctx.lineCap = "round";
  ctx.shadowBlur = 18;
  ctx.shadowColor = "#00ffcc";
  const grad = ctx.createLinearGradient(snake[0].x, snake[0].y, snake[snake.length - 1].x, snake[snake.length - 1].y);
  grad.addColorStop(0, "#00ffcc");
  grad.addColorStop(1, "#6600ff");
  ctx.strokeStyle = grad;

  ctx.beginPath();
  ctx.moveTo(snake[0].x + 5, snake[0].y + 5);
  for (let i = 1; i < snake.length; i++) {
    const prev = snake[i - 1];
    const curr = snake[i];
    ctx.quadraticCurveTo(prev.x + 5, prev.y + 5, (prev.x + curr.x) / 2 + 5, (prev.y + curr.y) / 2 + 5);
  }
  ctx.stroke();
  ctx.shadowBlur = 0;
}

function randomFood() {
  const x = Math.floor(Math.random() * 31) * grid;
  const y = Math.floor(Math.random() * 31) * grid;
  return { x, y };
}

// 🟣 التحكم بالإيقاف والاستئناف
function togglePause() {
  isPaused = !isPaused;
  document.getElementById("pauseSnake").textContent = isPaused ? "▶️ استئناف" : "⏸️ إيقاف";
  isPaused ? applyPausedStyle() : resetPausedStyle();
}

function pauseSnake() {
  isPaused = true;
  clearInterval(gameLoop);
  applyPausedStyle();
}

function resumeSnake() {
  clearInterval(gameLoop);
  gameLoop = setInterval(drawGame, speed);
}

function applyPausedStyle() {
  if (!snakeContainer) return;
  snakeContainer.style.border = "3px solid #777";
  snakeContainer.style.boxShadow = "0 0 20px rgba(200,200,200,0.3)";
  snakeContainer.animate(
    [{ transform: "scale(1)" }, { transform: "scale(1.03)" }, { transform: "scale(1)" }],
    { duration: 1000, iterations: Infinity, easing: "ease-in-out" }
  );
}

function resetPausedStyle() {
  if (!snakeContainer) return;
  snakeContainer.style.border = "3px solid #b066ff";
  snakeContainer.style.boxShadow = "0 0 25px rgba(176,102,255,0.6)";
  snakeContainer.getAnimations().forEach(a => a.cancel());
}
</script>




<!-- ========== 2-Player LANless Shooter Overlay (Ctrl+B) ========== -->
<style>
  /* طبقة اللعبة (زجاجية) */
  #duelOverlay {
    position: fixed; inset: 0;
    display: none; justify-content: center; align-items: center;
    background: rgba(5,10,20,0.45);
    backdrop-filter: blur(16px) saturate(140%);
    -webkit-backdrop-filter: blur(16px) saturate(140%);
    z-index: 999999;
    transition: opacity .25s ease;
    opacity: 0;
  }
  #duelOverlay.show { display:flex; opacity:1; }

  /* اللوحة العلوية للمعلومات */
  .duel-hud {
    position: absolute; top: 14px; left:50%; transform: translateX(-50%);
    display:flex; gap:18px; align-items:center; font-family: Cairo, sans-serif;
    color:#eaf2ff; text-shadow:0 2px 6px rgba(0,0,0,.35);
    user-select: none;
  }
  .hud-pill{
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.22);
    padding: 6px 12px; border-radius: 999px; font-weight:700; font-size:14px;
    box-shadow: inset 0 0 12px rgba(255,255,255,0.12);
  }

  /* تلميحات الأزرار أسفل اليمين */
  .duel-help {
    position:absolute; right:16px; bottom:14px; color:#dfe9ff; font-family:Cairo,sans-serif; font-size:13px;
    background: rgba(255,255,255,0.10); border:1px solid rgba(255,255,255,0.22); padding:8px 10px; border-radius:10px;
  }

  /* حدود صحون اللاعبين (زجاجي) */
  .tag {
    position:absolute; padding:6px 10px; border-radius:10px; font: 700 12px Cairo, sans-serif; color:#fff;
    background: rgba(255,255,255,0.15); border:1px solid rgba(255,255,255,0.25);
    transform: translate(-50%, -140%); pointer-events:none;
    text-shadow:0 2px 6px rgba(0,0,0,.35);
  }

  /* الكانفس */
  #duelCanvas { background:#0a0f1a; border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,.45); }
</style>

<div id="duelOverlay" aria-hidden="true">
  <canvas id="duelCanvas" width="960" height="540"></canvas>
  <div class="duel-hud">
    <div id="p1Hud" class="hud-pill">👤 Player 1 — ❤ <span id="p1Hp">5</span> | ★ <span id="p1Score">0</span></div>
    <div class="hud-pill">⏸ Space لإيقاف/تشغيل — Esc للخروج</div>
    <div id="p2Hud" class="hud-pill">👤 Player 2 — ❤ <span id="p2Hp">5</span> | ★ <span id="p2Score">0</span></div>
  </div>
  <div class="duel-help">
    Player 1: W A S D + F إطلاق<br/>
    Player 2: الأسهم + / إطلاق
  </div>
</div>

<script>
(() => {
  // يمنع لعبتين سوا
  if (window.__anyGameOverlayOpen == null) window.__anyGameOverlayOpen = false;

  const overlay = document.getElementById('duelOverlay');
  const canvas  = document.getElementById('duelCanvas');
  const ctx     = canvas.getContext('2d');

  const p1HpEl = document.getElementById('p1Hp');
  const p2HpEl = document.getElementById('p2Hp');
  const p1ScEl = document.getElementById('p1Score');
  const p2ScEl = document.getElementById('p2Score');

  let running = false, paused = false, rafId = null;

  const world = {
    W: canvas.width,
    H: canvas.height,
    friction: 0.88,
    bulletSpeed: 6,
    playerSpeed: 3.0,
    maxHP: 5
  };

  // مفاتيح مضغوطة
  const keys = new Set();

  // لاعبان
  const p1 = makePlayer(120, world.H/2, '#2ef2ff', '#00ffc6', 'P1');
  const p2 = makePlayer(world.W-120, world.H/2, '#ff5c93', '#ffcf5c', 'P2');

  // ذخيرة/عوائق
  const bullets = [];
  const obstacles = makeObstacles();

  // سماك لطلب الإطار
  function loop() {
    if (!running) return;
    if (!paused) update();
    draw();
    rafId = requestAnimationFrame(loop);
  }

  // أحداث مفاتيح
  window.addEventListener('keydown', (e) => {
    // فتح/إغلاق بـ Ctrl+B
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'b') {
      e.preventDefault();
      toggleDuel();
      return;
    }
    if (!overlay.classList.contains('show')) return;

    // Space = إيقاف/تشغيل مؤقت
    if (e.code === 'Space') { e.preventDefault(); paused = !paused; return; }
    // Esc = خروج
    if (e.key === 'Escape') { e.preventDefault(); closeDuel(); return; }

    keys.add(e.key);
    // إطلاق
    if (e.key.toLowerCase() === 'f') shoot(p1);
    if (e.key === '/') shoot(p2);
  });
  window.addEventListener('keyup', (e) => keys.delete(e.key));

  // توغل
  function toggleDuel() {
    // أغلق لعبة الحية إن كانت موجودة
    try {
      if (typeof toggleSnake === 'function') {
        // لو مفتوحة، اقفلها
        toggleSnake(); // الدالة عندك تقلب الحالة
      }
    } catch(_) {}

    if (overlay.classList.contains('show')) {
      closeDuel();
    } else {
      if (window.__anyGameOverlayOpen) return; // لعبة أخرى مفتوحة
      openDuel();
    }
  }

  function openDuel() {
    window.__anyGameOverlayOpen = true;
    overlay.style.display = 'flex';
    requestAnimationFrame(() => overlay.classList.add('show'));
    resetMatch();
    running = true; paused = false;
    loop();
  }

  function closeDuel() {
    running = false; paused = false;
    cancelAnimationFrame(rafId);
    overlay.classList.remove('show');
    setTimeout(() => {
      overlay.style.display = 'none';
      window.__anyGameOverlayOpen = false;
    }, 200);
  }

  // إنشاء لاعب
  function makePlayer(x, y, c1, c2, tag) {
    return {
      x, y, vx:0, vy:0, r:16,
      color1:c1, color2:c2,
      hp: world.maxHP, score:0, tag,
      cd: 0 // تبريد إطلاق
    };
  }

  function resetMatch() {
    Object.assign(p1, { x:120, y:world.H/2, vx:0, vy:0, hp:world.maxHP, cd:0 });
    Object.assign(p2, { x:world.W-120, y:world.H/2, vx:0, vy:0, hp:world.maxHP, cd:0 });
    bullets.length = 0;
    p1HpEl.textContent = p1.hp; p2HpEl.textContent = p2.hp;
    p1ScEl.textContent = p1.score; p2ScEl.textContent = p2.score;
  }

  function shoot(player) {
    if (player.cd > 0) return;
    const dir = aimDir(player);
    bullets.push({ x: player.x, y: player.y, vx: dir.x * world.bulletSpeed, vy: dir.y * world.bulletSpeed, owner: player });
    player.cd = 12; // فريمات تبريد
  }

  function aimDir(player) {
    // اتجاه افتراضي: P1 لليمين، P2 لليسار. أو حسب آخر حركة.
    let dx = (player === p1) ? 1 : -1, dy = 0;
    if (Math.abs(player.vx) + Math.abs(player.vy) > 0.5) {
      const len = Math.hypot(player.vx, player.vy) || 1;
      dx = player.vx / len; dy = player.vy / len;
    }
    return { x:dx, y:dy };
  }

  function update() {
    // تبريد إطلاق
    if (p1.cd > 0) p1.cd--;
    if (p2.cd > 0) p2.cd--;

    // حركة اللاعبين
    movePlayerP1();
    movePlayerP2();
    clampToArena(p1); clampToArena(p2);

    // حركة الرصاص
    for (let i = bullets.length - 1; i >= 0; i--) {
      const b = bullets[i];
      b.x += b.vx; b.y += b.vy;

      // اصطدام بالحواف
      if (b.x < 0 || b.x > world.W || b.y < 0 || b.y > world.H) {
        bullets.splice(i,1); continue;
      }

      // اصطدام عقبات
      if (hitObstacle(b.x, b.y)) { bullets.splice(i,1); continue; }

      // اصطدام بلاعب
      if (dist(b, p1) < p1.r && b.owner !== p1) { onHit(p1, b.owner); bullets.splice(i,1); continue; }
      if (dist(b, p2) < p2.r && b.owner !== p2) { onHit(p2, b.owner); bullets.splice(i,1); continue; }
    }
  }

  function onHit(victim, attacker) {
    victim.hp--; 
    if (victim === p1) p1HpEl.textContent = victim.hp; else p2HpEl.textContent = victim.hp;

    // موت
    if (victim.hp <= 0) {
      attacker.score++; 
      if (attacker === p1) p1ScEl.textContent = attacker.score; else p2ScEl.textContent = attacker.score;
      // جولة جديدة
      Object.assign(p1, { x:120, y:world.H/2, vx:0, vy:0, hp:world.maxHP, cd:0 });
      Object.assign(p2, { x:world.W-120, y:world.H/2, vx:0, vy:0, hp:world.maxHP, cd:0 });
      bullets.length = 0;
      p1HpEl.textContent = p1.hp; p2HpEl.textContent = p2.hp;
    }
  }

  function movePlayerP1() {
    let ax=0, ay=0;
    if (keys.has('w') || keys.has('W')) ay -= 1;
    if (keys.has('s') || keys.has('S')) ay += 1;
    if (keys.has('a') || keys.has('A')) ax -= 1;
    if (keys.has('d') || keys.has('D')) ax += 1;
    applyMove(p1, ax, ay);
  }
  function movePlayerP2() {
    let ax=0, ay=0;
    if (keys.has('ArrowUp')) ay -= 1;
    if (keys.has('ArrowDown')) ay += 1;
    if (keys.has('ArrowLeft')) ax -= 1;
    if (keys.has('ArrowRight')) ax += 1;
    applyMove(p2, ax, ay);
  }
  function applyMove(pl, ax, ay) {
    const len = Math.hypot(ax, ay) || 1;
    if (ax || ay) {
      pl.vx += (ax/len) * world.playerSpeed;
      pl.vy += (ay/len) * world.playerSpeed;
    }
    pl.vx *= world.friction; pl.vy *= world.friction;

    const nx = pl.x + pl.vx, ny = pl.y + pl.vy;
    // منع الدخول في العوائق: نطبق محورياً
    if (!circleHitAny(nx, pl.y, pl.r)) pl.x = nx;
    else pl.vx = 0;
    if (!circleHitAny(pl.x, ny, pl.r)) pl.y = ny;
    else pl.vy = 0;
  }

  function clampToArena(pl){
    pl.x = Math.max(pl.r, Math.min(world.W - pl.r, pl.x));
    pl.y = Math.max(pl.r, Math.min(world.H - pl.r, pl.y));
  }

  function circleHitAny(x, y, r) {
    return obstacles.some(ob => rectCircleCollide(ob, x, y, r));
  }

  function hitObstacle(x, y) {
    return obstacles.some(ob => (x > ob.x && x < ob.x+ob.w && y > ob.y && y < ob.y+ob.h));
  }

  function rectCircleCollide(ob, cx, cy, r) {
    const nx = Math.max(ob.x, Math.min(cx, ob.x+ob.w));
    const ny = Math.max(ob.y, Math.min(cy, ob.y+ob.h));
    return ( (cx-nx)**2 + (cy-ny)**2 ) <= r*r;
  }

  function dist(a,b){ return Math.hypot(a.x-b.x, a.y-b.y); }

  function makeObstacles() {
    // مستطيلات بسيطة في الوسط
    const arr = [];
    const pad = 80, thick=20, long=160;
    arr.push({x: world.W/2 - thick/2, y: world.H/2 - long/2, w: thick, h: long});
    arr.push({x: world.W/2 - long/2, y: world.H/2 - thick/2, w: long, h: thick});
    return arr;
  }

  function draw() {
    // خلفية مع تدرج خفيف
    const g = ctx.createLinearGradient(0,0, world.W, world.H);
    g.addColorStop(0, '#0a1020');
    g.addColorStop(1, '#0c162a');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,world.W, world.H);

    // عوائق زجاجية
    for (const ob of obstacles) {
      ctx.fillStyle = 'rgba(255,255,255,0.08)';
      ctx.fillRect(ob.x, ob.y, ob.w, ob.h);
      ctx.strokeStyle = 'rgba(255,255,255,0.28)';
      ctx.lineWidth = 1.5;
      ctx.strokeRect(ob.x+0.5, ob.y+0.5, ob.w-1, ob.h-1);
    }

    // رصاص
    for (const b of bullets) {
      ctx.beginPath();
      ctx.fillStyle = b.owner===p1 ? '#00ffc6' : '#ffcf5c';
      ctx.arc(b.x, b.y, 4, 0, Math.PI*2);
      ctx.shadowBlur = 12; ctx.shadowColor = ctx.fillStyle;
      ctx.fill(); ctx.shadowBlur = 0;
    }

    // لاعبين (جسم متدرج ولمعة)
    drawPlayer(p1);
    drawPlayer(p2);

    // تاغات أسماء (DOM أقل؟ نخلي Canvas أبسط)
    drawTag(p1, 'Player 1');
    drawTag(p2, 'Player 2');
  }

  function drawPlayer(pl) {
    // هالة
    ctx.beginPath();
    ctx.arc(pl.x, pl.y, pl.r+10, 0, Math.PI*2);
    ctx.fillStyle = (pl===p1) ? 'rgba(0,255,198,0.12)' : 'rgba(255,207,92,0.12)';
    ctx.fill();

    // جسم متدرج
    const grd = ctx.createRadialGradient(pl.x-6, pl.y-6, 4, pl.x, pl.y, pl.r);
    grd.addColorStop(0, pl.color1);
    grd.addColorStop(1, pl.color2);
    ctx.fillStyle = grd;
    ctx.beginPath();
    ctx.arc(pl.x, pl.y, pl.r, 0, Math.PI*2);
    ctx.shadowBlur = 20; ctx.shadowColor = pl.color2;
    ctx.fill(); ctx.shadowBlur = 0;

    // فوهة (اتجاه آخر حركة)
    const aim = aimDir(pl);
    ctx.strokeStyle = 'rgba(255,255,255,0.85)'; ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(pl.x, pl.y);
    ctx.lineTo(pl.x + aim.x*(pl.r+10), pl.y + aim.y*(pl.r+10));
    ctx.stroke();
  }

  function drawTag(pl, text) {
    ctx.font = '700 12px Cairo, sans-serif';
    ctx.fillStyle = 'rgba(255,255,255,0.9)';
    ctx.textAlign = 'center';
    ctx.fillText(text, pl.x, pl.y - (pl.r + 18));
  }
})();
</script>
<!-- ========== /2-Player Shooter ========== -->
<!-- 🌐 شريط التنقل السفلي -->
<!-- ✅ زر الواجهة الثانية -->
 <!-- ✅ الشريط السفلي الموحد -->
<div id="bottomBar">
  <button onclick="openPage2()" style="opacity:0.6;cursor:default;color:#9ecbff;">السكربتات 🧩</button>
  <button onclick="goHome()" style="color:#9ecbff;">الرئيسية 🏠</button>
</div>

<div id="page2Overlay">
  <iframe id="page2Frame" src=""></iframe>
</div>

<style>
/* 🌫️ شريط زجاجي شفاف لكن مرئي بشكل أوضح */
#bottomBar {
  position: fixed;
  bottom: 25px;
  left: 50%;
  transform: translateX(-50%);
  width: 260px;
  height: 68px;
  background: rgba(255, 255, 255, 0.06); /* ← زادت الشفافية شوي */
  border-radius: 50px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(35px) saturate(250%);
  -webkit-backdrop-filter: blur(35px) saturate(250%);
  box-shadow:
    inset 0 0 4px rgba(255,255,255,0.25),
    0 4px 25px rgba(0,0,0,0.15);
  display: flex;
  justify-content: space-around;
  align-items: center;
  z-index: 9999;
  overflow: hidden;
  transition: all 0.3s ease;
}

/* ✨ انكسار الضوء */
#bottomBar::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 50px;
  background: linear-gradient(
    to top,
    rgba(255,255,255,0.18),
    rgba(255,255,255,0.04)
  );
  opacity: 0.7;
  pointer-events: none;
  mix-blend-mode: screen;
}

/* ⚪️ الأزرار */
.nav-btn {
  position: relative;
  width: 58px;
  height: 58px;
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.05);
  color: rgba(255,255,255,0.9);
  font-size: 26px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow:
    inset 1px 1px 4px rgba(255,255,255,0.25),
    inset -2px -2px 5px rgba(0,0,0,0.15),
    0 3px 15px rgba(0,0,0,0.1);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
}

.nav-btn:hover {
  transform: scale(1.1);
  background: rgba(255,255,255,0.08);
  box-shadow:
    0 0 20px rgba(255,255,255,0.15),
    inset 2px 2px 8px rgba(255,255,255,0.4);
}

/* 🔵 النشط */
.nav-btn.active {
  background: rgba(40,94,255,0.18);
  box-shadow:
    0 0 25px rgba(40,94,255,0.45),
    inset 1px 1px 6px rgba(255,255,255,0.2);
  color: #fff;
  transform: scale(1.1);
}
#bottomBar button {
  background: none;
  border: none;
  color: #fff;
  font-size: 26px;
  cursor: pointer;
  transition: transform 0.3s ease;
}
#bottomBar button:hover {
  transform: scale(1.2);
}
#page2Overlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: #f7faff;
  z-index: 10000;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  opacity: 0;
  transition: opacity 0.6s ease;
}
#page2Overlay.show {
  display: flex;
  opacity: 1;
}
#page2Frame {
  width: 100%;
  height: 100%;
  border: none;
}
</style>

<script>
function openPage2() {
  const overlay = document.getElementById("page2Overlay");
  const frame = document.getElementById("page2Frame");

  // ✅ نتأكد إن العنصر ظاهر قبل تشغيل الأنيميشن
  overlay.style.display = "flex";
  setTimeout(() => overlay.classList.add("show"), 20);

  frame.src = "missingsol5.html"; // يربط الصفحة الثانية
}

function closePage2() {
  const overlay = document.getElementById("page2Overlay");
  const frame = document.getElementById("page2Frame");

  overlay.classList.remove("show");
  setTimeout(() => {
    // ✅ ما نحذف العنصر من العرض، فقط نخفيه مؤقتًا
    overlay.style.display = "none";
    frame.src = "";
  }, 600);
}


function goHome() {
  const overlay = document.getElementById("page2Overlay");
  if (overlay.classList.contains("show")) {
    // إذا كنا داخل الصفحة الثانية
    closePage2();
  } else {
    // إذا كنا بالصفحة الرئيسية فقط ننقل لأعلى الصفحة
    scrollTo(0, 0);
  }
}

// تأكد من أن overlay يظهر بعد التحميل
const overlay = document.getElementById("page2Overlay");
overlay.addEventListener("transitionstart", () => {
  overlay.style.display = "flex";
});
</script>

</body>

</html>
