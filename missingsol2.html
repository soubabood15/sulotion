<script>
function showUpdateNotice() {
  const notice = document.createElement("div");
  notice.innerHTML = "🔄 تم تحديث الصفحة إلى أحدث إصدار...";
  Object.assign(notice.style, {
    position: "fixed",
    bottom: "20px",
    right: "20px",
    background: "rgba(255,255,255,0.25)",
    backdropFilter: "blur(12px)",
    border: "1px solid rgba(255,255,255,0.4)",
    color: "#285eff",
    padding: "12px 20px",
    borderRadius: "14px",
    fontFamily: "Cairo, sans-serif",
    fontSize: "15px",
    fontWeight: "600",
    boxShadow: "0 4px 25px rgba(0,0,0,0.2)",
    zIndex: "999999",
    opacity: "0",
    transition: "opacity .6s ease"
  });
  document.body.appendChild(notice);
  setTimeout(() => (notice.style.opacity = "1"), 50);
  setTimeout(() => {
    notice.style.opacity = "0";
    setTimeout(() => {
      notice.remove();
    }, 600);
  }, 2500);
}

// 🧠 تحديث الصفحة تلقائياً فقط عند وجود تعديل جديد
let lastVersion = localStorage.getItem("siteVersion");

fetch(window.location.href, { method: "HEAD", cache: "no-store" })
  .then(res => {
    const newVersion = res.headers.get("etag") || res.headers.get("last-modified");
    if (lastVersion && newVersion && lastVersion !== newVersion) {
      showUpdateNotice();
      setTimeout(() => location.reload(true), 1500);
    }
    localStorage.setItem("siteVersion", newVersion);
  })
  .catch(err => console.warn("⚠️ فشل التحقق من التحديث:", err));
</script>
